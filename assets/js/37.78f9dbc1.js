(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{246:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"记一次-solo-迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记一次-solo-迁移"}},[s._v("#")]),s._v(" 记一次 solo 迁移")]),s._v(" "),a("blockquote",[a("p",[s._v("本篇博客迁移自 solo. 发表于 2018-11-01")])]),s._v(" "),a("h4",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("由于一些历史原因，我原来是将博客、网页部署在腾讯云的服务器上的，后来因为腾讯云的蜜汁服务体验，果断买了阿里云的服务器，不过由于腾讯云的域名时间有效期还很长，本着不要浪费的原则，我决定域名"),a("code",[s._v("zhijianzhang.cn")]),s._v(" 继续使用，而将原服务器上的 solo 博客迁移到阿里云上。所以有了一个比较尴尬的场景：使用腾讯云购买的域名和阿里云的服务器。.")]),s._v(" "),a("h5",{attrs:{id:"数据库迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库迁移"}},[s._v("#")]),s._v(" 数据库迁移")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("在新的目标服务器的数据库中创建一个名为 solo 的数据库\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzljMjc1MDFjNWNiZjRiNzFhNTlhNTNiZmJlM2YwMTM3X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("li",[a("p",[s._v("右键 Connection -> Data Transfer\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExL2EyOGExOGM1ZTZiMjQwODdiOTM1YmFhMDk0MzE4ZTA2X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("选择配置之后，就 Next -> Start\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExL2Y2OGRkMDUyNjU5OTQ5MWI4NTdlOGUwMDg0Njk3ZDcyX2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("迁移完了之后，目标服务器上有了 solo 数据表和数据\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzBiYjM2OTgyMGYzMTQ0MTg4ODY5NTllYzMyODA1Yzc3X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("h5",{attrs:{id:"项目文件迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目文件迁移"}},[s._v("#")]),s._v(" 项目文件迁移")]),s._v(" "),a("ol",[a("li",[s._v("压缩 solo 项目文件： "),a("code",[s._v("sudo tar zcvf solo.tar.gz solo-2.9.4/")]),s._v(" "),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExL2UwMWNiMDg5NGNiNDQ3MTQ5ZmI2ZTVmOTQ5NmEwMWNlX2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("通过 ubuntu 的 scp 命令向目标服务器传输这个压缩文件： "),a("code",[s._v("scp -r solo.tar.gz root@xxx.yy.cc.rrr:/usr/local/workspace/")]),s._v(". 输入密码之后就会开始慢慢传输文件\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzdlNmExNWZiM2ZkMDQ4OGRiYTZjZmVjNGI3ZThmY2E1X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("去目标服务器上解压文件"),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/workspace/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xzvf solo.tar.gz\n")])])]),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzU5YWI3MGVlM2FiODQzMjc5M2ZiM2Q3ZWNhOTEwYjhhX2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("启动 solo "),a("code",[s._v("nohup java -cp WEB-INF/lib/*:WEB-INF/classes org.b3log.solo.Starter >/dev/null 2>&1 &")]),s._v(", 启动就完事了，是不可能的。\n"),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzRhODNmYWQxYTBlZDRhZWE4NzM0NTdkYTQ4MDU1NWY3X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})])]),s._v(" "),a("p",[s._v("注意，我主要是为了操作方便，所以 mysql 的用户名和密码都是一致的，所以这里能直接不修改启动就行了。")]),s._v(" "),a("h5",{attrs:{id:"nginx-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" nginx 配置")]),s._v(" "),a("p",[s._v("其实这一步不算是迁移，就在新的服务器上为 solo 添加配置。 贴一下从 D 那抄的配置：")]),s._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" backend "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Tomcat/Jetty 监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  solo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zhijianzhang"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 博客域名")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Headers "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Origin, X-Requested-With, Content-Type, Accept"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Control"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Allow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Methods "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET, POST, OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("backend"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("  Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v("  X"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("p",[a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzRiZjI0YzAzOWM1NzQ5ZmViYTEwZmQ5MmU4YWQ2MzI5X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})]),s._v(" "),a("p",[s._v("我这边主要是在 "),a("code",[s._v("/etc/nginx/conf.d")]),s._v(" 中新建一个 "),a("code",[s._v("solo.conf")]),s._v(" 文件，写入上面的配置之后 "),a("code",[s._v("reload")]),s._v(" 一下 nginx 配置就行了。因为默认 "),a("code",[s._v("/etc/nginx/nginx.conf")]),s._v(" 会 "),a("code",[s._v("include")]),s._v(" 在 "),a("code",[s._v("conf.d")]),s._v(" 文件夹下的所有 "),a("code",[s._v(".conf")]),s._v(" 配置文件的内容。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -t\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx -s reload\n")])])]),a("h5",{attrs:{id:"云解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云解析"}},[s._v("#")]),s._v(" 云解析")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzNkYWM0MjRmZDc5ZjQ4NTM4NDY2ZDk5OGI0MmM4MTNiX2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:"imagepng"}})]),s._v(" "),a("p",[s._v("这里不要奇怪为什么在腾讯云的控制台，上面说了，因为是腾讯云上购买的域名，要云解析到阿里云的服务器的话，需要将整个域名在阿里云重新进行备案（其实跟在阿里云重新购买并备案一个域名差不多），时间上大概也是一个月左右，备案通过之后还是在腾讯云的控制台进行管理云解析。")]),s._v(" "),a("h5",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[s._v("#")]),s._v(" 最后")]),s._v(" "),a("p",[s._v("如果顺利的话，一般经过上述步骤之后，访问同一个"),a("a",{attrs:{href:"http://solo.zhijianzhang.cn",target:"_blank",rel:"noopener noreferrer"}},[s._v("域名"),a("OutboundLink")],1),s._v("，就能看到熟悉的博客了。如果不顺利的话，emmmm .... 聪明的你一定会发现哪里出了问题的！")]),s._v(" "),a("p",[s._v("（这篇笔记算是写了两遍...., solo 竟然在没有写标签的情况下没有触发自动保存，页面一切写了大半小时的内容就没了...）")]),s._v(" "),a("h5",{attrs:{id:"迁移过程的错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移过程的错误"}},[s._v("#")]),s._v(" 迁移过程的错误")]),s._v(" "),a("p",[s._v("迁移完了之后，需要写一篇博客看看数据能够正常保存。在发布博客的时候，有可能会出现如下的问题： "),a("img",{attrs:{src:"https://imgconvert.csdnimg.cn/aHR0cDovL21lZGlhLnpoaWppYW56aGFuZy5jbi8vZmlsZS8yMDE4LzExLzg2OTJhYTNjNjQ0ODRmYWJiMWMwNzZiM2Q3MjNjYWQ1X2ltYWdlLnBuZw?x-oss-process=image/format,png",alt:""}})]),s._v(" "),a("p",[s._v("本来以为出现这个问题的原因是由于数据库的格式引起的，手动去修改数据库格式为 "),a("code",[s._v("utf8mb4")]),s._v(" 之后生效了一会之后又不行了。后来改回原来的格式，发现重新新建的文章是可以保存成功的，出现这个原因只是单的这篇。")]),s._v(" "),a("p",[s._v("具体原因手动 @D")])])}),[],!1,null,null,null);t.default=r.exports}}]);