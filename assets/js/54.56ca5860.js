(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{497:function(e,t,r){"use strict";r.r(t);var s=r(3),a=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"使用-vercel-处理-node-js-的请求体"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-vercel-处理-node-js-的请求体"}},[e._v("#")]),e._v(" 使用 Vercel 处理 Node.js 的请求体")]),e._v(" "),t("p",[e._v("在使用 Vercel 部署的 Serverless 函数中解析 Node.js 的请求体。")]),e._v(" "),t("p",[e._v("在本篇指南中，我们将向你展示如何在使用 "),t("a",{attrs:{href:"https://vercel.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel"),t("OutboundLink")],1),e._v(" 部署的 "),t("a",{attrs:{href:"https://vercel.com/docs/v2/serverless-functions/introduction",target:"_blank",rel:"noopener noreferrer"}},[e._v("Serverless 函数"),t("OutboundLink")],1),e._v("中解析一个 "),t("a",{attrs:{href:"https://nodejs.org/en/docs/guides/anatomy-of-an-http-transaction/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js 的请求体"),t("OutboundLink")],1),e._v("， 而不需要额外导入一个框架，例如 Express。")]),e._v(" "),t("p",[e._v("本篇指南假设请求发送时携带有值是 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("application/json")]),t("OutboundLink")],1),e._v(" 的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("Content-Type")]),t("OutboundLink")],1),e._v(" 的请求头。但是，如果需要的话，可以解析更多的内容类型（其他的 "),t("code",[e._v("Content-Type")]),e._v("）。")]),e._v(" "),t("h2",{attrs:{id:"步骤-1-创建一个函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-创建一个函数"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://vercel.com/guides/handling-node-request-body#step-1:-creating-the-function",target:"_blank",rel:"noopener noreferrer"}},[e._v("步骤 1: 创建一个函数"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("首先，创建一个项目目录，并在其里面创建一个 "),t("code",[e._v("/api")]),e._v(" 目录， 接着再 "),t("code",[e._v("cd")]),e._v(" 进去：")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" req-body "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" req-body/api\n")])])]),t("p",[e._v("在 "),t("code",[e._v("/req-body")]),e._v(" 项目内部创建一个 "),t("code",[e._v("/api")]),e._v(" 目录。")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" req-body\n")])])]),t("p",[e._v("进入 "),t("code",[e._v("/req-body")]),e._v(" 项目目录。")]),e._v(" "),t("p",[e._v("为了说明请求体的解析，请使用以下代码在您的 "),t("code",[e._v("/api")]),e._v(" 目录中创建一个 "),t("code",[e._v("index.js")]),e._v(" 文件")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[e._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("exports")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("async")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" res")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" body "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("send")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("Hello ")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("name"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v(", you just parsed the request body!")]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("这是一个通过使用带有"),t("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects/node-js-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("Helper 属性"),t("OutboundLink")],1),e._v(" 的 "),t("a",{attrs:{href:"https://nodejs.org/dist/latest-v12.x/docs/api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js"),t("OutboundLink")],1),e._v(" 解析请求体的示例。")]),e._v(" "),t("p",[e._v("这个函数接受一个 POST 请求，解析请求体，并在响应中使用来自请求体的数据。")]),e._v(" "),t("p",[e._v("这里的关键部分是第 2 行。"),t("a",{attrs:{href:"https://vercel.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel"),t("OutboundLink")],1),e._v(" 添加了许多类似 Express 的 "),t("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects/node-js-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("helper properties"),t("OutboundLink")],1),e._v("，使使用 Node.js 的更加容易。")]),e._v(" "),t("p",[t("strong",[e._v("NOTE:")]),e._v(" 您可以在"),t("a",{attrs:{href:"https://vercel.com/blog/now-node-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("博客"),t("OutboundLink")],1),e._v(" 或者 "),t("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects/node-js-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("文档"),t("OutboundLink")],1),e._v(" 阅读更多有关 "),t("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects/node-js-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("helper 属性"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("p",[e._v("使用"),t("code",[e._v("req.body")]),e._v("的帮助器，将自动解析传入的"),t("code",[e._v("request")]),e._v("，从而无需第三方库或其他代码来处理 "),t("code",[e._v("request")]),e._v(" 正常抵达时候的默认格式 "),t("a",{attrs:{href:"https://nodejs.org/api/stream.html#stream_class_stream_readable",target:"_blank",rel:"noopener noreferrer"}},[e._v("ReadableStream"),t("OutboundLink")],1),e._v("。")]),e._v(" "),t("h2",{attrs:{id:"步骤-2-部署函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-部署函数"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://vercel.com/guides/handling-node-request-body#step-2:-deploying-the-function",target:"_blank",rel:"noopener noreferrer"}},[e._v("步骤 2: 部署函数"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("用一个命令就可以部署您的函数到 "),t("a",{attrs:{href:"https://vercel.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel"),t("OutboundLink")],1),e._v("：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("vercel\n")])])]),t("p",[e._v("使用"),t("code",[e._v("vercel")]),e._v("命令部署应用。现在您已经创建并部署了项目，剩下要做的就是测试它是否有效。")]),e._v(" "),t("h2",{attrs:{id:"步骤-3-发送请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-发送请求"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://vercel.com/guides/handling-node-request-body#step-3:-sending-the-request",target:"_blank",rel:"noopener noreferrer"}},[e._v("步骤 3: 发送请求"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("要验证是否正确解析了 JSON，请通过在终端内执行以下代码，使用 "),t("a",{attrs:{href:"https://curl.haxx.se/",target:"_blank",rel:"noopener noreferrer"}},[e._v("curl"),t("OutboundLink")],1),e._v(" 向新部署发出 POST 请求：")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-X")]),e._v(" POST "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"https://your-deployments-url.now.sh/api"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-H")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Content-Type: application/json"')]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-d")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{\n  "name": "Reader"\n}\'')]),e._v("\n")])])]),t("p",[e._v("使用 "),t("a",{attrs:{href:"https://curl.haxx.se/",target:"_blank",rel:"noopener noreferrer"}},[e._v("curl"),t("OutboundLink")],1),e._v(" 发出 POST 请求")]),e._v(" "),t("p",[t("strong",[e._v("NOTE:")]),e._v(" 这里您应该更换成您自己刚刚部署的 URL ，使其与在 Vercel CLI 中为您的部署提供的 URL 匹配。")]),e._v(" "),t("p",[e._v("您将收到类似于以下的回复:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Hello Reader, you just parsed the request body!\n")])])]),t("p",[e._v("发出 POST 请求的示例响应")]),e._v(" "),t("p",[e._v("恭喜，现在您知道如何在 "),t("a",{attrs:{href:"https://vercel.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Vercel"),t("OutboundLink")],1),e._v(" 使用 Node.js 解析请求请求体了。")]),e._v(" "),t("h2",{attrs:{id:"最后-理解它是如何工作的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最后-理解它是如何工作的"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://vercel.com/guides/handling-node-request-body#bonus:-understanding-why-this-works",target:"_blank",rel:"noopener noreferrer"}},[e._v("最后: 理解它是如何工作的"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("当 "),t("a",{attrs:{href:"https://nodejs.org/docs/latest-v8.x/api/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node.js"),t("OutboundLink")],1),e._v(" 接收到一个请求，请求体（返回体）是 "),t("a",{attrs:{href:"https://nodejs.org/api/stream.html#stream_class_stream_readable",target:"_blank",rel:"noopener noreferrer"}},[e._v("ReadableStream"),t("OutboundLink")],1),e._v(" 格式的。")]),e._v(" "),t("p",[e._v("要从 "),t("code",[e._v("Stream")]),e._v(" 中获取数据，您需要监听其 "),t("code",[e._v("data")]),e._v(" 和 "),t("code",[e._v("end")]),e._v(" 事件。要做到这一点，需要几行代码，而您更希望不要重复。")]),e._v(" "),t("p",[e._v("您可以通过使用 "),t("a",{attrs:{href:"https://vercel.com/docs/runtimes#official-runtimes/node-js/node-js-request-and-response-objects/node-js-helpers",target:"_blank",rel:"noopener noreferrer"}},[e._v("helper 属性"),t("OutboundLink")],1),e._v(" 直接访问请求体中的数据， 因为它已经为您解析了请求体。")])])}),[],!1,null,null,null);t.default=a.exports}}]);