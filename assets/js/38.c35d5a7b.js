(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{398:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"轻量应用服务器-mysql-远程连接踩坑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轻量应用服务器-mysql-远程连接踩坑"}},[s._v("#")]),s._v(" 轻量应用服务器 MySQL 远程连接踩坑")]),s._v(" "),a("p",[s._v("不算是给阿里云打广告吧，因为被阿里云的“云服务器 ECS” 和 “轻量应用服务器”搞的很蛋疼。很多年前，阿里云的学生机“云翼计划”默认就只有“云服务器 ECS”，所以上个月我准备去买一年的学生机的时候，几乎就选择性忽略框框中的内容，选择系统镜像就直接下单了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chatflow-files-cdn-1256085166.file.myqcloud.com/80/v2-777df1cf8577588921a93dc486c2af41_hd.jpg",alt:"这里写图片描述"}})]),s._v(" "),a("p",[s._v("买完之后开开心心安装 node nginx mysql docker 各种之后，等到我需要远程连接 mysql 的时候，花了我几个小时时间踩了一个坑。")]),s._v(" "),a("h3",{attrs:{id:"_1-登录服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-登录服务器"}},[s._v("#")]),s._v(" 1. 登录服务器")]),s._v(" "),a("p",[s._v("我没有去研究过服务器的什么 linux ssh 免密登录，因为我对 linux 不是太熟悉，介绍免密登录的博客看的我有点头大。我采用一种比较简单粗暴并且又能偷懒的方式来“免密登录”。")]),s._v(" "),a("p",[s._v("简单说就是 明文、脚本登录 ，即把 ssh 命令以及密码写入脚本里，要登录就执行脚本就行了。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" aliyun.sh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" aliyun.sh\n")])])]),a("p",[s._v("拷贝以下内容, 记得替换你自己的 ip 和密码：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/expect")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\nspawn "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("  root@xxx.xx.xx.xxx\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*password:"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("send "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\ninteract\n")])])]),a("p",[s._v("每次需要登录服务器的时候就 "),a("code",[s._v("./aliyun.sh")]),s._v(" 就行了。文件不泄露，一般也安全的吧。虽然办法土，但还算是节约了几秒钟的时间，主要还是为了偷懒。（为了安全起见，公司的服务器就别这么搞了，不过一般公司服务器也要安全的话 也会用 pin + token 来保证。 who cares ？）")]),s._v(" "),a("h3",{attrs:{id:"_2-安装-mysql-相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-mysql-相关"}},[s._v("#")]),s._v(" 2. 安装 mysql 相关")]),s._v(" "),a("h4",{attrs:{id:"查看是否安装-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看是否安装-mysql"}},[s._v("#")]),s._v(" 查看是否安装 Mysql")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tap "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysql\n")])])]),a("p",[s._v("如果为空则没有安装，进行安装：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mysql-server mysql-client\n")])])]),a("p",[s._v("根据提示输入密码，然后确认")]),s._v(" "),a("h4",{attrs:{id:"mysql-连接测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-连接测试"}},[s._v("#")]),s._v(" Mysql 连接测试")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql -u root -h localhost -p\n")])])]),a("p",[s._v("启动，停止，重启 Mysql 命令")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql start\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql stop\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" mysql restart\n")])])]),a("h4",{attrs:{id:"ubuntu-安装-mysql-忘记初始密码解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-安装-mysql-忘记初始密码解决方法"}},[s._v("#")]),s._v(" Ubuntu 安装 mysql 忘记初始密码解决方法")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//打开这个文件 /etc/mysql/debian.cnf\n//查看默认分配的密码\n[client]\nhost = localhost\nuser = debian-sys-maint\npassword = eyPDN7kavhmjCZUn （记住这个密码）\nsocket = [表情]ar/run/mysqld/mysqld.sock\n")])])]),a("h3",{attrs:{id:"输入命令进入-mysql-修改用户密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输入命令进入-mysql-修改用户密码"}},[s._v("#")]),s._v(" 输入命令进入 mysql 修改用户密码")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("// 输入命令后把上面的密码粘贴进去\nmysql -u debian-sys-maint -p\n//进入到mysql界面厚修改密码\nupdate mysql.user "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("authentication_string")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'newpassword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" where "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n//都要使用刷新权限列表\nflush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_3-终于开始要远程连接-mysql-了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-终于开始要远程连接-mysql-了"}},[s._v("#")]),s._v(" 3. 终于开始要远程连接 mysql 了...")]),s._v(" "),a("p",[s._v("如果是完全按照上面的操作，直接打开 navicat ，输入 ip、port 这些信息 test connect 的时候一定会报下面的这种错误的：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("2003 - Can't connect to MySQL server on 'xxx.xx.xx.xxx' (61 \"Connection refused\")\n")])])]),a("p",[s._v("好的，我知道了，那我开一下防火墙端口，设置一个 mysql 的账号用来远程连接吧。这些网上基本都有很详细的教程，我简单列一下命令：（主要也是给我自己偷懒，知道大概的步骤是怎么样的，但是命令太长，记不住，浪费几秒钟。）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n\n// 进入mysql\nmysql -u root -p\n\n// 新建一个有远程连接权限的账号\n//"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$username")]),s._v("表示用户名,%表示所有的电脑都可以连接,也可以设置某个ip地址运行连接,"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$password")]),s._v("表示密码\nGRANT ALL PRIVILEGES ON *.* TO "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$username")]),s._v("'")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$password")]),s._v("'")]),s._v(" WITH GRANT OPTION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nflush privileges"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n// 查看所有用户和权限\nSELECT DISTINCT CONCAT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User: '")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("',user,'")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@'")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("',host,'")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("';'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AS query FROM mysql.user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n// 修改mysql配置\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/mysql.conf.d/mysqld.cnf // 如果你是按照我的方式安装的mysql， bind-address 这一行是在这个文件\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bind-address = 127.0.0.1 这一行注释")]),s._v("\n\n// 重启mysql\n/etc/init.d/mysql restart\n")])])]),a("p",[s._v("这个时候 "),a("code",[s._v("talent ip 3306")]),s._v(" 还不通，说明防火墙 3306 端口没有开。按照网上所介绍的阿里云安全组规则去打开端口，具体也不介绍了，网上很多，看图也能明白。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chatflow-files-cdn-1256085166.file.myqcloud.com/80/v2-8852fbf2c74555fceb4e9c6d8b596668_hd.jpg",alt:"这里写图片描述"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chatflow-files-cdn-1256085166.file.myqcloud.com/80/v2-e22f395fc0cb034514fc782980f86496_hd.jpg",alt:"这里写图片描述"}})]),s._v(" "),a("p",[s._v("舒服了，终于写完了，test connect 一下，报错：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("MYSQL ERROR 2003 (HY000): Can't connect to MySQL server on 'xxx.xxx.xx.xxx'\n")])])]),a("p",[s._v("啊，不应该啊，我都是按照流程来的，于是重新看了一遍，发现没有漏掉的、也没有不对的。很郁闷啊，觉得自己的操作完全没有问题，大家都说配置一下安全组就好了，一定是阿里云想坑我！")]),s._v(" "),a("p",[s._v("接着排查，但都正常。")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tlanp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n")])])]),a("p",[s._v("...\n各种折腾中...\n...")]),s._v(" "),a("p",[a("strong",[s._v("下面就是我想说的坑点了：")]),s._v(" 我发现我买的竟然是 "),a("strong",[s._v("轻量应用服务器")]),s._v("。。。 讲道理我也不知道这个是个什么鬼，后来就发现了")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chatflow-files-cdn-1256085166.file.myqcloud.com/80/v2-777df1cf8577588921a93dc486c2af41_hd.jpg",alt:"这里写图片描述"}})]),s._v(" "),a("p",[s._v("原来左侧是由切换的。后来发现了轻量应用服务器的防火墙配置：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://chatflow-files-cdn-1256085166.file.myqcloud.com/80/v2-278bf0987d3037bb8e3f8173755a00b6_hd.jpg",alt:"这里写图片描述"}})]),s._v(" "),a("p",[s._v("这里配置了 3306 之后， "),a("code",[s._v("talent ip 3306")]),s._v(" 就通了，记得应用类型要选 "),a("code",[s._v("MYSQL")]),s._v(" ，接着 test connect 就绿了。")]),s._v(" "),a("p",[s._v("哇！ 所以我到底是被谁坑了！")]),s._v(" "),a("h2",{attrs:{id:"坑都被坑了之我就看一下有没有亏"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#坑都被坑了之我就看一下有没有亏"}},[s._v("#")]),s._v(" 坑都被坑了之我就看一下有没有亏")]),s._v(" "),a("p",[s._v("轻量应用服务器优势，我只看见了 40g ssd，其他的我也不管，大概是没有亏？")]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("我其实的确是想吐槽的，我一直以为我买的是普通的云服务器，网上搜远程连接 mysql 的时候，几乎是没有关于轻量应用服务器滴，这就又引导我到了“李鬼”那里。看了一下阿里云的论坛，似乎现在也不能将我这个一年的轻量应用服务器换成 ECS 了。算了算了，也行吧，反正也能用，我也不挑的。")]),s._v(" "),a("p",[s._v("还有啊，你们家阿里云的广告啊，都贴到我们公司门口了！我们家云不要面子的啊！啊西八，我一定会贴回来的。")]),s._v(" "),a("p",[s._v("所以，最终还是我自己坑的我自己 ToT... 菜。")])])}),[],!1,null,null,null);t.default=e.exports}}]);