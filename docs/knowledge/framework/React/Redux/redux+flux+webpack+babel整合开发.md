---
title: 懒加载的实现原理
date: '2020-10-26'
draft: true
---

### 背景知识

- ES6
- Component 组件和模块的发展
- 前端开发常用工具：
  - 包管理器（Package Manager）
  - 任务流工具（Task Runner），用来执行一系列开发中的任务。
  - 模块打包工具（Bundler）, 用来转换和合并代码的模式。

### ES6

#### 语言

1. Javascript 中变量默认是全局性的，只存在函数级作用域，声明函数曾经是创造作用域的唯一办法。ES6 中的 let 关键字声明的变量拥有块级作用域。
2. const 声明一个常量，定义之后不能修改，但如果是引用类型，就可以修改它的属性。
3. 箭头函数永远是匿名的。
4. Array 的 map 方法。
5. this 在箭头函数中的使用。
6. 函数的默认参数
7. Rest 参数：当一个函数的最后一个参数有“...”这样的前缀，它就会变成一个参数的数组。它与 arguments 有如下区别：
   1. Rest 参数只是没有指定变量名称的参数数组，arguments 是所有参数的集合。
   2. arguments 对象不是一个真正的数组，而 Rest 参数是一个真正的数组，可以使用各种方法，比如 sort， map 等。
8. 展开操作符 “...” 。

### Babel

Babel 的核心概念就是利用一系列的 plugin 来管理编译规则。

babel 是通过安装插件（plugin）或者预设（preset， 就是一组设定好的插件）来编译代码的。

首先创建一个配置文件`.babelrc`。

```
// .babelrc
{
  "preset":[],
  "plugins":[]
}
```

下面来安装一个预设，它可以把 ES6 代码编译成 ES5 代码：

```
npm i --save-dev babel-preset-es2015
```

将这个 preset 添加到配置文件中：

```
{
  "preset":['es2015'],
  "plugins":[]
}
```

## 前端组件化方案

### ES6 模块

```
// 通过相对路径获得依赖模块
import bar from './bar'
// 模块产出
export default function() {
  // ...
}
```

### 任务流工具

#### grunt

#### glup

### 模块打包工具

#### browserify

#### webpack

支持 AMD 和 CommonJS 类型，通过 loader 机制也可以使用 ES6 的模块格式。

# Webpack

前端的模块系统经历了长久的演变，对应的打包方案从最初简单的文件合并，到 AMD 的模块具名化并合并，再到 browserify 将 CommonJS 模块转化为浏览器端可运行的代码，打包器做的事情越来越复杂。

# React

React 只和用户的界面打交道，属于 MVC 中的 V（视图）层。

特点：

1. 组件

2. JSX

3. Virtual DOM

   在 React 的设计中，开发者不太需要操作真正的 DOM 节点，每一个组件都是 Virtual DOM 渲染的，它是一种对于 HTML DOM 节点的抽象描述，你可以把它看成是一种用 Javascript 实现的结构。Virtual DOM 采用了更高效的渲染方式，组件的 DOM 结构映射到 Virtual DOM 上，当需要重新渲染组件时，React 在 Virtual DOM 上实现了一个 Diff 算法，通过这个算法寻找需要变更的节点，再把里面的修改更新到实际需要修改的 DOM 节点上，这样就避免了渲染整个 DOM 带来的巨大成本。

# 实践 React

## 开发项目

开发 React 项目的流程:

### 将原型图分割更不同的组件

看到原型图之后，要做的事情就是在原型图上画方块，然后给他们命名。组件的原则是，一个组件理想情况下应该只做一件事情。如果发现它有过多的功能，那么你可以把它分割成更多的自组件。

### 创建每一个静态组件

无状态函数：当一个组件不需要内部的 state， 不需要组件的生命周期这些方法的时候，可以把它简写成一个纯函数，减少代码量。

当一个组件什么都不关心，只是传入属性，展示属性的值或者对外输出方法，不考虑交互，那么就写成一个无状态组件。

在循环展示子组件时，每一个子组件都有一个唯一的 key 值，这是为了保证重新渲染的效率，提高内部 Diff 算法的效率。
