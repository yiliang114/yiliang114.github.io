---
title: 懒加载的实现原理
date: '2020-10-26'
draft: true
---

## 前后端同构（微医）

结合了 SSR 和 CSR ，公用一套模板引擎。

## Vue SSR 有什么特点？

1. 前后端公用一套模板引擎
2. SPA 的优秀用户体验
3. SEO 的支持
4. 首屏渲染速度

但是也有美中不足
关键问题一：稳定性（问题分析，异常容灾）
关键问题二：性能（Vnode 慢，HTTP 慢）
关键问题三：差异（DOM、BOM、Cookie、API）
关键问题四：上手难度（Vue 全家桶、Nodejs 基础）

### 关键问题一：稳定性

SSR 生命周期出现异常怎么办？

1. 使用 lodash 处理接口判空
2. 使用 errorHandler 函数捕获接口异常
3. 捕获整个 Vue 生命周期异常
4. PM2、监控、日志管理
5. 异常熔断、自动降级（从 SSR 链接跳转到 SPA）
6. 可控全局降级，应对突发大流量

### 关键问题二：性能

页面请求 waiting 时间过长？

1. 静态页面应用长缓存
2. 针对未登陆用户应用短缓存
3. TCP 长连接优化
4. 服务端请求走内网
5. 优化异步任务流程

### 关键问题三：差异

SSR 与 CSR 环境差异怎么处理？

1. 封装接口，统一接口调用规范
2. Cookie 的统一处理
3. 组件库、插件、工具函数的兼容
4. 通过 URL 参数降级，方便查看接口调用

### 关键问题四：上手难度

毫无 Vue SSR 开发经验如何快速上手？

1. 强大的 asyncData 函数，脱离 vuex
2. 规范制定（context, errorHandler）
3. 维护开发文档
4. 沟通交流，技术分享

### 规划

1. 架构分离（npm 包，配置化，cli）
2. 可靠性优化（单元测试，内存泄漏检测）
3. HTTP 优化（更优的服务端通信方式）

## Vue vs React

- 设计理念
- 概念堆砌
- SSR 支持
- API 设计
- 生态成熟度
- 模板渲染
- 数据流
- HOC vs mixins
- 数据变化原理
- 组件通信
- App 支持
- 构建工具
- 上手成本
- 开发效率
- 维护难度
