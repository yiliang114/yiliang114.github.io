---
title: Node 业务
date: '2020-10-26'
draft: true
---

### Node

<!-- https://juejin.cn/post/6844904084709834766 -->

基于 egg 来搭建的。 ts + egg ，为什么不用 koa2 因为 egg 不就是 koa 上封了一层么，自己能少做一点事情。

- 日志记录
- 日志、错误上报、错误邮件告警
- graph ql
- sequence 快速新建数据库表
- 快速创建路由并注册
- 权限系统
- api 网页调试工具， 不用每次都开 postman
  - 记录每次的值，直接点击即可
- 单元测试

### 考虑的方面

1. 安全
2. 缓存
3. 消息服务
4. 网关
5. 限流
6. 权限
7. 日志
8. 逻辑数据中心路由
9. 虚拟 IP

#### 作用

1. 简化客户端逻辑，减少网络开销
2. 避免无意义透传
3. 敏感信息过滤

#### 接口的设计

1. 细粒度
2. 通用的功能，可能会被其他很多 BFF 用到。
3. 提供包含各种真实状态的 mock 服务，易于同步开发。
4. 合理设计接口的数量，太多不易开发。
5. 提供含各种状态的 mock 真实数据，页面不依赖 server 开发。
6. 多协议发布
7. 规范数据格式

### 热更新 ?

如何在不重启 node 进程的情况下热更新一个 js/json 文件? 这个问题本身是否有问题?

### BFF 基建

BFF

代码脚手架 控制层通过模版生成
代码热更新
可视化编排
线上出问题，到服务器看日志，看日志做成线上化，线上问题提前预知？接口报错等，线上化。

前端，开发流程，创意的点：
首先是本地开发，脚手架生成代码框架，做 mock 数据，因为有依赖后段，来做前置性的开发，引入了来源的能力。

Bff 调试，测试自动化，历史接口保证稳定性，可视化平台展示自动化的结果。

发布上线部署，node 依赖需要重新安装，如何做到增量部署？不要全量构建？
