---
title: 技术驱动
date: 2020-11-21
aside: false
draft: true
---

场景是一个输入框，输入过程中如果输入了单个 { 符号的话，出现 tag 标签，并且出现下拉框

### 遇到的问题

1. input width 如果设置为 auto 的话跟没有设置是一样的，默认 html5 原生 input 的 width content 是 125 px

2. 需要动态获取输入框中的内容的长度，有几个方案

   1. vue 的 v-model 可以直接获取双向绑定的值，通过 value.length 可以直接获取长度。 一个 input content 的计算方式是 value.length \* font-size 但是有一个问题，数字、英文字体与中文字体的宽度计算方式不一致，也就是说上面的计算方式仅限于中文，如果 value 中包含英文或者数字，width 计算是不准的。
   2. 监听 input 的 input 事件（注意与 change 事件的差别）变动的 dom 节点的获取是 event.target 。 默认情况不指定 input 的 width 的话，输入超出 width 的文本可能乎出现滑动条或者字符往左进行滚动，通过 event.target.scrollWidth 可以直接获取 input 真实的 width 不需要考虑是什么字符

3. 在 vue 中的解决方案

   1. 在 input 监听回调中通过 e.target.style.width = e.target.scrollWidth + "px"; 可以达到我们想要的效果，但是理论上这是在直接操作 dom，在 vue 中也算是比较忌讳的。

   2. 直接通过 vue 的指令来实现 v-autoWidth 加上即可。 input 每次输入都会执行指令的 update 钩子函数，首次挂载的时候执行 bind 钩子函数，首次执行的时候为了初始化 input 的长度。

      ```
        directives: {
          autoWidth: _debounce(function(el) {
            el.style.width = el.scrollWidth + "px";
          })
        },
      ```

      需要注意的是这里不能够使用限频，因为同一个指令有被多次使用，就会在渲染期间多次触发，限频会被影响。

   3. <http://www.cnblogs.com/cythia/p/5977643.html> 另一种方案。。

   4. 指令中没有 this 指向 vm， 但是如果需要获取 this 的话，vnode.context 就是指向当前的 this 的。

参考：

<https://blog.csdn.net/superit401/article/details/72473318>

<https://blog.csdn.net/young_Emily/article/details/77335158>

```
        // clientWidth = width（可见区域）+ padding - 滚动条宽度
        // offsetWidth = width（可见区域） + padding + border（若有滚动条宽，那就包含在里面了）
        // scrollWidth = width（自身实际长度，包括不可见区） + padding + border + margin
```
