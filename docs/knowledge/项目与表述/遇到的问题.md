---
title: 遇到的问题
date: 2020-11-21
aside: false
draft: true
---

## 遇到的问题

### 按需加载

在使用组件库的时候，我们经常见到“按需加载”的身影，意思就是我需要的组件就加载进来，其他的就不要，以此减小打包结果的体积。

### 大文件上传

### 自定义提示保存弹框的处理

有几个不同版本：

#### 不使用 vue-router 使用原生的 confirm 函数

缺点： 难看，不能自定义。

#### 能使用 vue-router

使用 vue-router 的钩子函数，主动赋值 next 函数

#### 不使用 vue-router

1. seajs 中我是如何进行处理的。
2. seajs 中这样处理的问题在哪里？ 最后我是如何进行处理的？

### 骨架屏的实现

https://juejin.im/post/5d457bad5188255d8249c7f4

https://github.com/lavas-project/vue-skeleton-webpack-plugin

https://juejin.im/post/5d457bad5188255d8249c7f4

### 测试

#### yagao

e2e 黑盒测试。
注入一个 cdn + chrome 扩展插件，执行 js 脚本。 api 的话，参考 vue-test-utils

### 开发环境热更新缓慢

现象： 做了简单的 router code split 之后，由于项目引入的资源过大，app.js 以及一些 chunk 还是达到了 10 几甚至 20 几 M ，导致在 dev 环境下 ， 页面刷新也很慢。（build 之后其实相对还好， 开启 gzip 之后也就几百 k）。刷新加载需要很多秒

分析：

导致 chunk 大有可能的原因：

1. 引入的包过多，多大。 最有可能的冗余包：
   1. ant icon
   2. moment.js
2. 代理的网络的原因，因为有时候本地加载开发资源时间是几百毫秒级别，有时候是好多秒，造成了开发阶段的体验很差。

确认自己的猜想：

1. vue ui 或者安装 webpack 的一个插件可视化查看造成 chunk 大的原因

解决方案:

1. 开发环境继续拆包
2. 编译缓存，hapack cache-loader 继续缓存被编译的部分，让热加载更新的部分只更新修改的部分（尽可能少）
3. 排查网络原因

### 可配置化的前端项目

1. json 中无法写函数，写的函数无法很好的注入 content 或者 this 之类的上下文，除非改造函数的写法，比如 vm => vm.data 之类的将 this 传入
   解决： 参考 vscode 中的 ui 可配置化，采用 when 的形式，对操作符进行处理，将 when 字符串拼接上 with(this) 执行的接口会被自动 return， 这样就可以直接写属性名的判断条件，而不用带上 this 之类的前缀

2. 随着项目的更新，旧的配置解析器慢慢显示出一些问题（项目初期设计不算太完善），但是线上已经有多个项目在跑了，新功能要加入旧解析器不能再很好的工作了。
   解决： 优雅降级，对于老的组件，额外开发一些 transfor 转换器，将新配置（可读性更好）的配置转化成旧配置进行渲染； 对于新组件，直接将新的配置文件进行解析渲染。

### console

1. 意图配置的 tag 输入框，多 tag 下拉框的位置计算
2. 页面跳转的处理，vuex 存储 next（）
3. 轮询接口的封装
4. requestId 捕捉器
5. vuex 的小封装

### h5

1. 1px 那个问题，以前是直接通过 dpi 进行缩放，现在的解决是通过媒体查询，进行缩放
2. h5 的输入框、键盘的处理，安卓 ios 等等会有不同的表现

### 全栈

https://www.cnblogs.com/wuguanglin/p/stuer1.html

### 前端模板

#### react

https://github.com/react-redux-antd-es6/react
https://github.com/react-boilerplate/react-boilerplate
https://github.com/mhaagens/react-mobx-react-router4-boilerplate
https://github.com/mobxjs/mobx-react-boilerplate

#### vue

https://github.com/chrisvfritz/vue-enterprise-boilerplate
https://github.com/petervmeijgaard/vue-2-boilerplate
https://github.com/Heeexy/SpringBoot-Shiro-Vue
https://github.com/icebob/vue-express-mongo-boilerplate
https://github.com/boylegu/SpringBoot-vue

### babel 插件

### webpack 插件和 loader

### eslint

https://segmentfault.com/a/1190000014230857

#### prettier

https://www.cnblogs.com/demi-guoba/p/12893802.html

#### 团队的 eslint

https://trainspott.in/2018/12/07/vscode+vetur+eslint+prettier%E5%AE%9E%E7%8E%B0%E5%9B%A2%E9%98%9F%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E7%BB%9F%E4%B8%80/

https://www.cnblogs.com/smileSmith/p/7449496.html

https://blog.csdn.net/Axela30W/article/details/72900678?locationNum=7&fps=1

#### eslint 在线配置规则

### vue jsx props 与 attrs 问题

需要完全自己制定好，哪些是 props 哪些是 attrs， 如果将传值放到了 props 中，但是组件中又没有声明好 prop 类型，这些值就会丢失。

### 后台相关的技术驱动

1. 前端日志上报，读懂 emonitor 应该就可以了。
2. SSR/CSR 优雅降级。

### 前端安全问题

CSRF ？？？

g_tk 算法

https://www.cnblogs.com/a849788087/p/6440264.html

http://km.oa.com/articles/show/409728

### 遇到过的问题

- 工作过程中遇到什么难题，是怎么解决的？
- 在 Vue 中使用 localStorage 的时候， computed 不能够触发 getter 的重新计算，如何解决的。 通过自定义事件。

- vue 项目中搜索高亮，通过正则表达式拼接标签高亮，再通过 v-html 显示，能够高亮，但是会带来跨站攻击 ？需要手动过滤 script 标签等
- v-html 你的站点上动态渲染的任意 HTML 可能会非常危险，因为它很容易导致 XSS 攻击。请只对可信内容使用 HTML 插值，绝不要对用户提供的内容插值。
- 你项目中如何进行用户输入过滤的？都过滤了那些内容？(根据回答有了下一个问题)
- 为什么没有过滤<img>标签？
- vue 项目目录 assets 和 static 的区别
  assets 里面的会被 webpack 打包进你的代码里，而 static 里面的，就直接引用了。一般在 static 里面放一些类库的文件，在 assets 里面放属于该项目的资源文件。如上面所说的 reset.css 会放在 static 文件夹中比较好

##### 正则匹配中文出错

背景：如何使用正则判断字符串中是否全部是中文？
通过百度或者 google 之后得到的答案一般都是：

```
const reg = /^[\u4e00-\u9fa5]*$/
reg.test('中文')
```

但是实际上遇到了一个中文 "䃼" 的时候，正则就返回了错误。 一开始没有意识到这是一个不常见的中文，或者换句话说没有意识到不常见的中文没有落在上面的正则表达式里。在线中文转化 unicode 之后得到这个字的 unicode 编码是 "\u40fc", 看起来确实没有落在上面正则的范围里。补上一般完整的中文编码符号。https://blog.bvcode.com/res/159/

##### 在 created 钩子中直接使用了 await (没有同步执行。。。) 生命周期是一个队列， 生命周期钩子内的异步请求又是一个队列。 async 表示 created 钩子中的函数会同步执行，而并非是先执行完 created 钩子之后再执行 mounted。

### 在 Vue 中使用 localStorage 的时候， computed 不能够触发 getter 的重新计算，如何解决的。 通过自定义事件

### ios 的禁止回弹效果

整个页面的禁止回弹效果处理；
对于页面中的某一个模块的回调效果取消处理

### 驾驶舱的顶部 Tab 渲染同 ID 的 Item 的顺序错乱现象

对于一个 Tab 组件，传入的一个元素是 Tab 对象的数组，渲染一个 Tabs 列表。 数据举例如下：

```js
const A = [0, 1, 2, 3];

const B = [0, 1, 2];
```

对于 A B 两个数组， 最后一个元素的 Id 相等，前面的 Id 都不同。在切换 Tabs 的过程中，就是替换 A B 数组的值。但是每次切换的过程中，最后一个 Tab 位置总是会跑到第一位（首次渲染的位置相同。）， 后来想了一下这个原因是因为 Vue 在增加删除节点的时候，相同的 Key 的元素，就当做旧元素，已经消失的 Key 元素，节点会被删除；而原本不存在的节点，会被作为新 Key 插入到后面。 这就是为什么，最后一个 Tab 元素在切换过程中跑到最前面去的原因，这里只要改一下，用不同的 Key 值即可。

### 小程序

小程序内嵌 h5 ，可视化， 计算数据等等，性能成问题，现在 pc 上进行内存检查，在手机上查看占用的内存等等

### 页面跳转之前的请求没有结束，会被 cancel

https://segmentfault.com/a/1190000013132078

日志上报的失败率比较高，很多都是直接被 cancel (abort) 调的。

使用 `navigator.sendBeacon` 打点上报有一个好处， 对于页面直接跳转的情况，也能上报数据，而不会被 cancel。 所以 navigator.sendBeacon 的部分，其实并不需要 await 它，正常写同步的顺序就好。
