---
title: 性能优化
date: 2020-11-21
draft: true
---

## 性能优化

### 方向

1. 减少页面体积，提升网络加载
2. 优化页面渲染
3. 提高（开发环境）编译的速度

### 标准

1. 尽量减少 HTTP 请求数。比如合并接口，使用 url-loader 将小的图片处理成 base64 到 HTML 中
2. 开启 DNS 预解析，使用 CDN 静态资源服务器。 `<link rel="dns-prefetch" href="//yiliang.site">`
3. 使用强缓存、协商缓存
4. 使用非阻塞方式下载 js 脚本， 异步加载等。
   1. 动态脚本加载： 使用 JS 创建一个 script 标签再插入到页面中
   2. defer（IE）：整个 HTML**解析完**后才会执行，如果是多个，按照加载顺序依次执行
   3. async： **加载完**之后立即执行，如果是多个，执行和加载顺序无关
5. webpack code split 进行切割 bundle 文件，使用 ES6 模块来开启 tree shaking，组件库提供 es module 形式按需加载等。
6. 合并 DOM 插入,DOM 操作是非常耗费性能的，因此插入多个标签时，先插入 Fragment 然后再统一插入 DOM。
7. 事件节流、防抖
8. 删减 cookie， 静态文件额外申请一个不包含 cookie 的域。
9. 服务器开启 Gzip 等压缩。差不多能压缩 1/4 的体积。
10. 合理使用 requestAnimationFrame 动画代替 setTimeout
11. 使用 Web Workers
12. 使用 HTTP2
13. 选用合适的图片格式 webp 最合适 ？，图片懒加载、组件懒加载、请求懒加载
14. list 海量数据，虚拟列表

### 必说

1. 静态资源使用强缓存、协商缓存，并使用 CDN
2. webpack code split 、使用 es module 形式组件或者使用 `babel-plugin-import` 按需加载组件开启 tree shaking
3. 资源懒加载，比如使用 vue-lazyLoader
4. 虚拟列表
5. HTTP2，多路复用、首部压缩、多请求并发等
6. 使用服务端渲染优化首屏加载速度
7. 代码层面，事件节流、防抖，事件代理；合理使用 requestAnimationFrame 动画代替 setTimeout
8. 优化 webpack 的开发速度，尝鲜 vite

## 如何实施

性能优化的标准中提到的都是单个点，性能优化项目具体实施起来，应该按照下面步骤推进:

1. 建立性能数据收集平台，摸底当前性能数据，通过性能打点，将上述整个页面打开过 程消耗时间记录下来
2. 分析耗时较长时间段原因，寻找优化点，确定优化目标
3. 开始优化
4. 通过数据收集平台记录优化效果
5. 不断调整优化点和预期目标，循环 2~4 步骤

## 首屏

如何提升移动端用户的使用体验，让用户能更快的看到页面
移动端适配方案
