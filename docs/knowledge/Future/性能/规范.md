---
layout: CustomPages
title: performance
date: 2020-11-21
aside: false
draft: true
---

## 性能优化

- 网络部分
  - 尽量减少 HTTP 请求数
    - 合并文件
    - 雪碧图
    - 小图 Base64
  - 减少 DNS 查找
    - 开启 DNS 预解析
  - 使用 CND 静态资源服务器
  - 避免重定向
  - 杜绝 404
- 缓存
  - 配置 ETags
    - 实体标签（ETags），是服务器和浏览器用来决定浏览器缓存中组件与源服务器中的组件是否匹配的一种机制
  - 添上 Expires 或者 Cache-Control HTTP 头
  - 使用外链的方式引入 JS 和 CSS（缓存）
- 内容部分
  - 按需加载组件
  - 预加载组件
  - 减少 DOM 元素的数量
  - 尽量少用 iframe
  - 压缩 JavaScript 和 CSS（代码层面）
- CSS 部分
  - 避免使用 CSS 表达式
  - 选择`<link>`而不是`@import`
  - 避免使用滤镜
  - 把样式表放在顶部
- JS 部分
  - 把脚本放在底部
  - 去除重复脚本
  - 减少 DOM 访问
- 图片部分
  - 选用合适的图片格式
  - 雪碧图中间少留空白
  - 不要用 HTML 缩放图片，要小图就去加载小图
  - 用小的可缓存的 favicon.ico
- cookie
  - 给 cookie 减肥
    - 清除不必要的 cookie
    - cookie 尽可能小
    - 设置好合适的域
    - 合适的有效期
  - 把静态资源放在不含 cookie 的域下
    - 当浏览器发送对静态图像的请求时，cookie 也会一起发送，而服务器根本不需要这些 cookie。
- 移动端
  - 保证所有组件都小于 25K
  - 把组件打包到一个复合文档里
- 服务器
  - 开启 Gzip 等压缩
  - 避免图片 src 属性为空（为空浏览器也会向服务器发送另一个请求）
  - 对 Ajax 用 GET 请求
  - 尽早清空缓冲区
  - 使用 CDN（内容分发网络）
    - 内容分发网络（CDN）是一组分散在不同地理位置的 web 服务器，用来给用户更高效地发送内容。

## 重构优化性能

- 表格(table)布局改为 DIV + CSS
- 使网站前端兼容于现代浏览器(针对于不合规范的 CSS、如对 IE6 有效的)
- 对于移动平台的优化
- 针对于 SEO 进行优化
- 深层次的网站重构应该考虑的方面
- 减少代码间的耦合
- 让代码保持弹性
- 严格按规范编写代码
- 设计可扩展的 API
- 代替旧有的框架、语言(如 VB)
- 增强用户体验
- 通常来说对于速度的优化也包含在重构中
- 压缩 JS、CSS、image 等前端资源(通常是由服务器来解决)
- 程序的性能优化(如数据读写)
- 采用 CDN 来加速资源加载
- 对于 JS DOM 的优化
- HTTP 服务器的文件缓存
- 让页面结构更合理化，提升用户体验
- 实现良好的页面效果和提升性能

## 编码规范

### 常见编码规范

- 将 js 脚本放在页面底部，加快渲染页面
- 将 js 脚本将脚本成组打包，减少请求
- 使用非阻塞方式下载 js 脚本
- 尽量使用局部变量来保存全局变量
- 遵循严格模式："use strict";
- 尽量减少使用闭包
- 减少对象成员嵌套
- 缓存 DOM 节点访问
- 避免使用 eval()和 Function()构造器
- 尽量使用直接量取创建对象和数组
- 最小化重绘(repaint)和回流(reflow)

### 非核心代码的异步加载

- 动态脚本加载
  - 使用 JS 创建一个 script 标签再插入到页面中
- defer（IE）
  - 整个 HTML**解析完**后才会执行，如果是多个，按照加载顺序依次执行
- async
  - **加载完**之后立即执行，如果是多个，执行和加载顺序无关
