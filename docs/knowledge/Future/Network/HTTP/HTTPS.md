---
layout: CustomPages
title: HTTP
date: 2020-11-21
aside: false
draft: true
---

## HTTPS

HTTPS = HTTP + SSL

如何进行加密和解密的。

HTTPS 证书如何进行授权和校验， 最主要是本地的根域名服务器解析出来需要匹配上。

HTTP 默认采用 80 作为通讯端口，对于传输采用不加密的方式，https 默认采用 443，对于传输的数据进行加密传输。

HTTPS 还是通过了 HTTP 来传输信息，但是信息通过 TLS 协议进行了加密。

HTTP 有以下安全性问题：

- 使用明文进行通信，内容可能会被窃听；
- 不验证通信方的身份，通信方的身份有可能遭遇伪装；
- 无法证明报文的完整性，报文有可能遭篡改。

HTTPS 并不是新协议，而是让 HTTP 先和 SSL（Secure Sockets Layer）通信，再由 SSL 和 TCP 通信，也就是说 HTTPS 使用了隧道进行通信。

通过使用 SSL，HTTPS 具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）。

### 讲解一下 HTTPS 的工作原理

HTTPS 在传输数据之前需要客户端（浏览器）与服务端（网站）之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。TLS/SSL 协议不仅仅是一套加密传输的协议，更是一件经过艺术家精心设计的艺术品，TLS/SSL 中使用了非对称加密，对称加密以及 HASH 算法。握手过程的简单描述如下：

- 浏览器将自己支持的一套加密规则发送给网站。
- 网站从中选出一组加密算法与 HASH 算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含了网站地址，加密公钥，以及证书的颁发机构等信息。
- 获得网站证书之后浏览器要做以下工作：

a) 验证证书的合法性（颁发证书的机构是否合法，证书中包含的网站地址是否与正在访问的地址一致等），如果证书受信任，则浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。

如果证书受信任，或者是用户接受了不受信的证书，浏览器会生成一串随机数的密码，并用证书中提供的公钥加密。

- 使用约定好的 HASH 计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。
- 4.网站接收浏览器发来的数据之后要做以下的操作：

a) 使用自己的私钥将信息解密取出密码，使用密码解密浏览器发来的握手消息，并验证 HASH 是否与浏览器发来的一致。

b) 使用密码加密一段握手消息，发送给浏览器。

- 5.浏览器解密并计算握手消息的 HASH，如果与服务端发来的 HASH 一致，此时握手过程结束，之后所有的通信数据将由之前浏览器生成的随机密码并利用对称加密算法进行加密。

### 讲解一下 HTTPS 对称加密和非对称加密

对称加密：
发送方和接收方需要持有同一把密钥，发送消息和接收消息均使用该密钥。相对于非对称加密，对称加密具有更高的加解密速度，但双方都需要事先知道密钥，密钥在传输过程中可能会被窃取，因此安全性没有非对称加密高。

非对称加密：
接收方在发送消息前需要事先生成公钥和私钥，然后将公钥发送给发送方。发送放收到公钥后，将待发送数据用公钥加密，发送给接收方。接收到收到数据后，用私钥解密。
在这个过程中，公钥负责加密，私钥负责解密，数据在传输过程中即使被截获，攻击者由于没有私钥，因此也无法破解。
非对称加密算法的加解密速度低于对称加密算法，但是安全性更高。

几个名词要理清
RSA：非对称加密
AES：对称加密 生成一个随机字符串 key 只有客户端和服务端有 他们两个通过这个 key 对数据加密和传输跟解密 这一个统称对称加密
CA：权威认证机构 服务器在建站的时候 去 CA 认证机构认证 得到对应的数字签名 相当于身份证号 客户端每次安装浏览器的时候 都会下载最新的 CA 列表 这个列表有对应的数字签名和服务器 IP 一一对应的列表 这就是为什么我们自己搭建的 localhost 没法发 HTTPS 的原因 因为没法进行 CA 认证
数字证书：包含了数字签名跟 RSA 公钥
数字签名：保证数字证书一定是服务器传给客户端的 相当于服务器的身份证 ID
对称密钥： 对数据进行加密的 key
非对称密钥： （k1， k2） k1 加密的数据 只有 k2 能解开 k1 位非对称公钥 k2 为非对称私钥
非对称公钥：RSA 公钥 k1 加密的数据 只有 k2 能解开
非对称私钥：RSA 私钥 k1 加密的数据 只有 k2 能解开

### HTTPS 通信过程

HTTPS 协议 = HTTP 协议 + SSL/TLS 协议

在 HTTPS 数据传输的过程中，需要用 SSL/TLS 对数据进行加密和解密，再通过 HTTP 对加密后的数据进行传输。

**SSL**的全称是 Secure Sockets Layer，即安全套接层协议，是为网络通信提供安全及数据完整性的一种安全协议。

**TLS**的全称是 Transport Layer Security，即安全传输层协议，最新版本的 TLS 是一种新的协议，它建立在 SSL 3.0 协议规范之上。虽然 TLS 与 SSL3.0 在加密算法上不同，但是在我们理解 HTTPS 的过程中，我们可以把 SSL 和 TLS 看做是同一个协议。

HTTPS 为了兼顾安全与效率，**同时使用了对称加密和非对称加密**。数据是被对称加密传输的，对称加密过程需要客户端的一个密钥，为了确保能把该密钥安全传输到服务器端，采用非对称加密对该密钥进行加密传输，总的来说，**对数据进行对称加密，对称加密所要使用的密钥通过非对称加密传输**。

HTTPS 在传输的过程中会涉及到三个密钥：

- 服务器端的公钥和私钥，用来进行非对称加密
- 客户端生成的随机密钥，用来进行对称加密

一个 HTTPS 请求实际上包含了两次 HTTP 传输，可以细分为 8 步。

1. 客户端向服务器发起 HTTPS 请求，连接到服务器的 443 端口
2. 服务器端有一个密钥对，即公钥和私钥，是用来进行非对称加密使用的，服务器端保存着私钥，不能将其泄露，公钥可以发送给任何人。
3. 服务器将自己的公钥发送给客户端。
4. 客户端收到服务器端的公钥之后，会对公钥进行检查，验证其合法性，如果发现发现公钥有问题，那么 HTTPS 传输就无法继续。严格的说，这里应该是验证服务器发送的数字证书的合法性。如果公钥合格，那么客户端会生成一个随机值，这个随机值就是用于进行对称加密的密钥，我们将该密钥称之为 client key，即客户端密钥，这样在概念上和服务器端的密钥容易进行区分。然后用服务器的公钥对客户端密钥进行非对称加密，这样客户端密钥就变成密文了，至此，HTTPS 中的第一次 HTTP 请求结束。
5. 客户端会发起 HTTPS 中的第二个 HTTP 请求，将加密之后的客户端密钥发送给服务器。
6. 服务器接收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端密钥，然后用客户端密钥对数据进行对称加密，这样数据就变成了密文。
7. 然后服务器将加密后的密文发送给客户端。
8. 客户端收到服务器发送来的密文，用客户端密钥对其进行对称解密，得到服务器发送的数据。这样 HTTPS 中的第二个 HTTP 请求结束，整个 HTTPS 传输完成。

原文链接：https://www.jianshu.com/p/14cd2c9d2cd2

#### HTTP 和 HTTPS

`HTTP`协议通常承载于 TCP 协议之上，在`HTTP`和`TCP`之间添加一个安全协议层（`SSL`或`TSL`），这个时候，就成了我们常说的 HTTPS。

默认 HTTP 的端口号为 80，`HTTPS`的端口号为 443。

#### 为什么`HTTPS`安全

因为网络请求需要中间有很多的服务器路由器的转发。中间的节点都可能篡改信息，而如果使用`HTTPS`，密钥在你和终点站才有。`HTTPS`之所以比`HTTP`安全，是因为他利用`SSL/tls`协议传输。它包含证书，卸载，流量转发，负载均衡，页面适配，浏览器适配，refer 传递等。保障了传输过程的安全性。

在 HTTPS 握手的第四步中，如果站点的证书是不受信任的，会显示出现下面确认界面，确认了网站的真实性。另外第六和八步，使用客户端私钥加密解密，保证了数据传输的安全。

HTTPS 加密是在传输层。https 报文在被包装成 tcp 报文的时候完成加密的过程，无论是 HTTPS 的 header 域也好，body 域也罢都是会被加密的。

当使用 tcpdump 或者 wireshark 之类的 tcp 层工具抓包，获取是加密的内容，而如果用应用层抓包，使用 Charels(Mac)、Fildder(Windows)抓包工具，那当然看到是明文的。

### 分别介绍 HTTP 与 HTTPS 握手过程

#### HTTP 握手过程

第一次握手：客户端发送 syn 包(syn=j)到服务器，并进入 SYN_SEND 状态，等待服务器确认；

第二次握手：服务器收到 syn 包，必须确认客户的 SYN（ack=j+1），同时自己也发送一个 SYN 包（syn=k），即 SYN+ACK 包，此时服务器进入 SYN_RECV 状态；

第三次握手：客户端收到服务器的 SYN ＋ ACK 包，向服务器发送确认包 ACK(ack=k+1)，此包发送完毕，客户端和服务器进入 ESTABLISHED 状态，完成三次握手。

#### HTTPS 握手过程

1.建立服务器 443 端口连接
2.SSL 握手：随机数，证书，密钥，加密算法 3.发送加密请求 4.发送加密响应 5.关闭 SSL 6.关闭 TCP

1.客户端发起 HTTPS 请求 2.服务端的配置
采用 HTTPS 协议的服务器必须要有一套数字证书，可以是自己制作或者 CA 证书。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用 CA 证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥。公钥给别人加密使用，私钥给自己解密使用。 3.传送证书
这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等。 4.客户端解析证书
这部分工作是有客户端的 TLS 来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值，然后用证书对该随机值进行加密。 5.传送加密信息
这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了。 6.服务段解密信息
服务端用私钥解密后，得到了客户端传过来的随机值(私钥)，然后把内容通过该值进行对称加密。所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。 7.传输加密后的信息
这部分信息是服务段用私钥加密后的信息，可以在客户端被还原。 8.客户端解密信息
客户端用之前生成的私钥解密服务段传过来的信息，于是获取了解密后的内容。
PS: 整个握手过程第三方即使监听到了数据，也束手无策。

### HTTP 月 HTTPS 有什么不同，为什么会变慢？ 需要做哪些校验？为什么会更安全？ 证书如何被判断为不安全的？

### HTTPS 中间人攻击

### HTTPS 的缺点

- 因为需要进行加密解密等过程，因此速度会更慢；
- 需要支付证书授权的高额费用。

### HTTP 和 HTTPS 的区别

`HTTP`协议通常承载于 TCP 协议之上，在`HTTP`和`TCP`之间添加一个安全协议层（`SSL`或`TSL`），就成了我们常说的 HTTPS。默认 HTTP 的端口号为 80，`HTTPS`的端口号为 443。

在网络请求需要中间有很多的服务器路由器的转发，中间的节点都可能篡改信息，而如果使用`HTTPS`，密钥在你和终点站才有。`HTTPS`之所以比`HTTP`安全，是因为他利用`SSL/tls`协议传输。它包含证书，卸载，流量转发，负载均衡，页面适配，浏览器适配，refer 传递等。保障了传输过程的安全性。

首先 HTTP 和 HTTPS 的默认端口号就不一样，HTTP 的默认端口号为 80，HTTPS 的默认端口号为 443，HTTP 在传输过程中使用的是明文
传输，内容可能被窃取，而且无法验证通信方的身份，还有可能遭遇身份伪装，而 HTTPS 在应用层和传输层之间增加了 SSL 协议用来加密
内容，因此通过证书验证来验证身份，即使数据被窃取也无法解密，数据的传输更加安全。

1. HTTPS 协议需要到 ca 申请证书或自制证书。
2. HTTP 的信息是明文传输，https 则是具有安全性的 SSL 加密。
3. HTTP 是直接与 TCP 进行数据传输，而 HTTPS 是经过一层 SSL（OSI 表示层），用的端口也不一样，前者是 80（需要国内备案），后者是 443。
4. HTTP 的连接很简单，是无状态的；HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全。

HTTP 的 URL 以 HTTP:// 开头，而 HTTPS 的 URL 以 HTTPS:// 开头
HTTP 是不安全的，而 HTTPS 是安全的
HTTP 标准端口是 80 ，而 HTTPS 的标准端口是 443
在 OSI 网络模型中，HTTP 工作于应用层，而 HTTPS 的安全传输机制工作在传输层
HTTP 无法加密，而 HTTPS 对传输的数据进行加密
HTTP 无需证书，而 HTTPS 需要 CA 机构 wosign 的颁发的 SSL 证书

- HTTP 协议通常承载于 TCP 协议之上，在 HTTP 和 TCP 之间添加一个安全协议层（SSL 或 TSL），这个时候，就成了我们常说的 HTTPS
- 默认 HTTP 的端口号为 80，HTTPS 的端口号为 443

### HTTPS 握手过程中，客户端如何验证证书的合法性

客户端会有一个有效证书串，一般的浏览器都会内置很多常见服务器的这个证书，特殊的服务器就需要前期通过手工将证书添加到客户端。证明对方是否持有证书的对应的私钥,客户端通过比对来确认证书的有效性

### HTTPS 的详细过程，使用的加密算法，是对称加密算法还是非对称加密算法。md5、SHA、AES 分别是对称加密的还是非对称加密的

### HTTPS 没有大规模应用的原因

### 介绍一下 HTTPS 的连接过程

### SSL 加密使用了那种算法，如何加密

### 认证

通过使用 **证书** 来对通信方进行认证。

数字证书认证机构（CA，Certificate Authority）是客户端与服务器双方都可信赖的第三方机构。

服务器的运营人员向 CA 提出公开密钥的申请，CA 在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公开密钥证书后绑定在一起。

进行 HTTPS 通信时，服务器会把证书发送给客户端。客户端取得其中的公开密钥之后，先使用数字签名进行验证，如果验证通过，就可以开始通信了。

### TLS

TLS 的中文名？TLS 在哪一网络层？

1. 客户端发送一个随机值，需要的协议和加密方式
2. 服务端收到客户端的随机值，自己也产生一个随机值，并根据客户端需求的协议和加密方式来使用对应的方式，发送自己的证书（如果需要验证客户端证书需要说明）
3. 客户端收到服务端的证书并验证是否有效，验证通过会再生成一个随机值，通过服务端证书的公钥去加密这个随机值并发送给服务端，如果服务端需要验证客户端证书的话会附带证书
4. 服务端收到加密过的随机值并使用私钥解密获得第三个随机值，这时候两端都拥有了三个随机值，可以通过这三个随机值按照之前约定的加密方式生成密钥，接下来的通信就可以通过该密钥来加密解密

通过以上步骤可知，在 TLS 握手阶段，两端使用非对称加密的方式来通信，但是因为非对称加密损耗的性能比对称加密大，所以在正式传输数据时，两端使用对称加密的方式通信。
