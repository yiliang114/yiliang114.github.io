---
title: 代码题 1
date: '2020-11-02'
draft: true
---

### 代码题 1

```js
var foo = 'Hello';
(function() {
  var bar = ' World';
  alert(foo + bar);
})();
alert(foo + bar);
```

问题：上面两个 alert 的结果是什么
**答案: "Hello World" 和 ReferenceError: bar is not defined**

### 图片预览

```html
<input type="file" name="file" onchange="showPreview(this)" /> <img id="portrait" src="" width="70" height="75" />
```

```js
function showPreview(source) {
  var file = source.files[0];
  if (window.FileReader) {
    var fr = new FileReader();
    fr.onloadend = function(e) {
      document.getElementById('portrait').src = e.target.result;
    };
    fr.readAsDataURL(file);
  }
}
```

### [1,2,3]map(parseInt)

1 NaN NaN

因为 parseInt 的两个参数分别是 string 和 进制转化。

### class 构造函数执行的顺序

```js
class B {
  b = console.log('1');
  constructor() {
    console.log('2');
  }
}

class A extends B {
  a = console.log('3');
  constructor() {
    super();
    console.log('4');
  }
}

new A();
new B();

// 1234
```

### 对象深度，空对象当作一级，属性值为数组则不向下查找

```js
// 递归，深度优先遍历
function getObjectDeep(obj, arr = []) {
  var count = 0;
  obj && arr.indexOf(obj) === -1 && arr.push(obj);
  if (obj && !Array.isArray(obj) && typeof obj === 'object') {
    count = 1;
    var result = Object.keys(obj).map(function(item) {
      if (typeof obj[item] === 'object' && arr.indexOf(obj[item]) === -1) {
        // 防止循环引用
        arr.push(obj[item]);
        return 1 + getObjectDeep(obj[item], arr);
      } else {
        return 1;
      }
    });
    for (var i = 0; i < result.length; i++) {
      if (count < result[i]) {
        count = result[i];
      }
    }
  }
  return count;
}

// 非递归，宽度优先遍历
function getObjectDeep(obj) {
  var count = 0;
  var queueObj = [obj];
  var arrs = [obj]; // 防止循环引用
  var last = obj; // 当前层级最后一个

  var checkObj = function(param) {
    return param !== null && param !== undefined && !Array.isArray(param) && typeof param === 'object';
  };

  if (checkObj(obj)) {
    while (queueObj.length) {
      var currentObj = queueObj.shift();
      Object.keys(currentObj).forEach(function(item) {
        if (checkObj(currentObj[item]) && arrs.indexOf(currentObj[item]) === -1) {
          arrs.push(currentObj[item]);
          queueObj.push(currentObj[item]);
        }
      });
      if (currentObj === last) {
        count += 1;
        last = queueObj.length ? queueObj[queueObj.length - 1] : null;
      }
    }
  }

  return count;
}
```

### 实现下面这道题中的 machine 函数

```js
function machine() {}
machine('ygy').execute();
// start ygy
machine('ygy')
  .do('eat')
  .execute();
// start ygy
// ygy eat
machine('ygy')
  .wait(5)
  .do('eat')
  .execute();
// start ygy
// wait 5s（这里等待了5s）
// ygy eat
machine('ygy')
  .waitFirst(5)
  .do('eat')
  .execute();
// wait 5s
// start ygy
// ygy eat
```

```js
function machine() {
  var txt = arguments[0];
  return new Job(txt);
}

function Job(name) {
  this.name = name;
  this.fn = Promise.resolve();
  this.jobs = [{ fn: () => console.log('start ', this.name) }];
}

Job.prototype.execute = function() {
  this.jobs.forEach(
    job =>
      (this.fn = this.fn.then(() => {
        return new Promise(resolve => {
          setTimeout(() => {
            resolve(job.fn());
          }, job.time || 0);
        });
      })),
  );
};
Job.prototype.do = function(str) {
  this.jobs.push({ fn: () => console.log(`${this.name} ${str}`) });
  return this;
};
Job.prototype.wait = function(num) {
  this.jobs.push({ fn: () => console.log(`wait ${num}s`), time: num * 1000 });
  return this;
};

Job.prototype.waitFirst = function(num) {
  this.jobs.unshift({
    fn: () => console.log(`wait ${num}s`),
    time: num * 1000,
  });
  return this;
};

// 关注点分离
function machine() {
  var txt = arguments[0];
  return new Job(txt);
}

function Job(name) {
  this.name = name;
  this.jobs = [new JobItem(() => console.log('start ', this.name))];
}

function JobItem(fn, time) {
  this.fn = fn;
  this.time = time || 0;
}

function defer(job) {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve(job.fn());
    }, job.time || 0);
  });
}

Job.prototype.execute = async function() {
  while (this.jobs.length) {
    const job = this.jobs.shift();
    await defer(job);
  }
};
Job.prototype.do = function(str) {
  this.jobs.push(new JobItem(() => console.log(`${this.name} ${str}`)));
  return this;
};
Job.prototype.wait = function(num) {
  this.jobs.push(new JobItem(() => console.log(`wait ${num}s`), num * 1000));
  return this;
};

Job.prototype.waitFirst = function(num) {
  this.jobs.unshift(new JobItem(() => console.log(`wait ${num}s`), num * 1000));
  return this;
};
```

### 函数组合运行

说明：实现一个方法，可将多个函数方法按从左到右的方式组合运行。 如 composeFunctions(fn1,fn2,fn3,fn4)等价于 fn4(fn3(fn2(fn1))。
实例：

```js
const add = x => x + 1;
const multiply = (x, y) => x * y;
const multiplyAdd = composeFunctions(multiply, add);
multiplyAdd(3, 4); // 返回 13
```

```js
function composeFunctions() {
  var slice = Array.prototype.slice;
  var fnArgs = slice.call(arguments, 0);
  return function() {
    var args = slice.call(arguments, 0);
    if (fnArgs.length === 1) {
      return fnArgs[0].apply(this, args);
    }
    return fnArgs.reduce(function(fn1, fn2) {
      return fn2(fn1.apply(this, args));
    });
  };
}
```

### 将给定元素插入到从小到大排序数组的合适位置，并返回插入值下标，如果数组中已存在该值，则直接返回该值下标。

```js
function insert(arr, num) {
  if (arr && Array.isArray(arr)) {
    var left = 0;
    var right = arr.length - 1;
    var mid = 0;
    while (left <= right) {
      mid = Math.floor((left + right) / 2);
      if (num > arr[mid]) {
        left = mid + 1;
      } else if (num < arr[mid]) {
        right = mid - 1;
      } else {
        return mid;
      }
    }
    arr.splice(left, 0, num);
    return left;
  }
  return -1;
}
```

### 输出程序运行结果

```js
var x = 1;

var bar = function() {
  console.log(this.x);
};

var obj1 = { x: 1 };
var obj2 = { x: 2 };
var obj3 = { x: 3 };

var fun = bar.bind(obj1);
fun();
fun = bar.bind(obj1).bind(obj2);
fun();
fun = bar
  .bind(obj1)
  .bind(obj2)
  .bind(obj3);
fun();
/*
1
1
1
*/
```

### 将文本整理成 3 行四列

```js
d2d 99 @12 .,sk
     <sss 90 "dd" ssaa!q
   ka ak   askjk  kajk
整理成
[ [ 'd2d', '99', '@12', '.,sk' ],
  [ '<sss', '90', '"dd"', 'ssaa!q' ],
  [ 'ka', 'ak', 'askjk', 'kajk' ] ]
```

```js
var string = `
  d2d 99 @12 .,sk
     <sss 90 "dd" ssaa!q
   ka ak   askjk  kajk
   `;

function fn(str) {
  var arr = [];
  var current = [];
  var arrTemp = [];
  var start = 0;
  var end = str.length;
  var currentStr = '';
  var spaceStr = ' ';
  var newLineStr = '\n';
  while (start < end) {
    currentStr = str[start++];
    if (currentStr === spaceStr) {
      if (arrTemp.length) {
        current.push(arrTemp.join(''));
        arrTemp.length = 0;
      }
    } else if (currentStr === newLineStr) {
      if (arrTemp.length) {
        current.push(arrTemp.join(''));
        arrTemp.length = 0;
      }
      if (current.length) {
        arr.push(current);
      }
      current = [];
    } else {
      arrTemp.push(currentStr);
    }
    if (start === end) {
      if (arrTemp.length) {
        current.push(arrTemp.join(''));
      }
      if (current.length) {
        arr.push(current);
      }
    }
  }
  return arr;
}
console.log(fn(string));
```

### 常见

1. js 对象校验是否含有多个键值

```
['id', 'name', 'check'].every(key => Object.keys(project).includes(key))
```

2. js 两个数组取差集

```
arrayA.filter(key => !arrayB.includes(key))
```

3. script 引入 js 文件时带入参数

### 问题

问题：`foo`的值是什么？\_

```javascript
var foo = 10 + '20';
```

_问题：如何实现以下函数？_

```javascript
add(2, 5); // 7
add(2)(5); // 7
```

_问题：下面的语句的返回值是什么？_

```javascript
"i'm a lasagna hog"
  .split('')
  .reverse()
  .join('');
```

_问题：`window.foo`的值是什么？_

```javascript
window.foo || (window.foo = 'bar');
```

_问题：下面两个 alert 的结果是什么？_

```javascript
var foo = 'Hello';
(function() {
  var bar = ' World';
  alert(foo + bar);
})();
alert(foo + bar);
```

_问题：`foo.length`的值是什么？_

```javascript
var foo = [];
foo.push(1);
foo.push(2);
```

_问题：`foo.x`的值是什么？_

```javascript
var foo = { n: 1 };
var bar = foo;
foo.x = foo = { n: 2 };
```

_问题：下面代码的输出是什么？_

```javascript
console.log('one');
setTimeout(function() {
  console.log('two');
}, 0);
console.log('three');
```

### 如何将浮点数点左边的数每三位添加一个逗号，如 12000000.11 转化为『12,000,000.11』?\*\*

```
function commafy(num){
	return num && num
		.toString()
		.replace(/(\d)(?=(\d{3})+\.)/g, function($1, $2){
			return $2 + ',';
		});
}
```

### 解释一下这段代码的意思吗？\*\*

```javascript
[].forEach.call($$('*'), function(el) {
  el.style.outline = '1px solid #' + (~~(Math.random() * (1 << 24))).toString(16);
});
```

- 解释：获取页面所有的元素，遍历这些元素，为它们添加 1 像素随机颜色的轮廓(outline)
- 1. `$$(sel)` // \$\$函数被许多现代浏览器命令行支持，等价于 document.querySelectorAll(sel)
- 2. `[].forEach.call(NodeLists)` // 使用 call 函数将数组遍历函数 forEach 应到节点元素列表
- 3. `el.style.outline = "1px solid #333"` // 样式 outline 位于盒模型之外，不影响元素布局位置
- 4. `(1<<24)` // parseInt("ffffff", 16) == 16777215 == 2^24 - 1 // 1<<24 == 2^24 == 16777216
- 5. `Math.random()*(1<<24)` // 表示一个位于 0 到 16777216 之间的随机浮点数
- 6. `~~Math.random()*(1<<24)` // `~~` 作用相当于 parseInt 取整
- 7. `(~~(Math.random()*(1<<24))).toString(16)` // 转换为一个十六进制-

### 创建一个循环，从 1 迭代到 100，`3`的倍数时输出 "fizz"，`5`的倍数时输出 "buzz"，同时为`3`和`5`的倍数时输出 "fizzbuzz"。

来自 [Paul Irish](https://gist.github.com/jaysonrowe/1592432#gistcomment-790724)的 FizzBuzz。

```js
for (let i = 1; i <= 100; i++) {
  let f = i % 3 == 0,
    b = i % 5 == 0;
  console.log(f ? (b ? 'FizzBuzz' : 'Fizz') : b ? 'Buzz' : i);
}
```

### 打印一个对象

```js
let description = '';
for (let i in this.questionsForm) {
  let property = this.questionsForm[i];
  description += i + ' = ' + property + '\n';
}
console.log(description);
```

### 写一个方法 region()，获取数字的区间

```js
function region(num1, num2) {
  var min = Math.min(num1, num2),
    max = Math.max(num1, num2),
    ret = [];
  for (++min; min < max; ) {
    ret.push(min++);
  }
  if (num1 > num2) return ret.reverse().join();

  return ret.join();
}
```

### 写一个方法，为元素添加 class？

```js
function addClass(elem, className) {
  if (!elem) return;
  var reClass = new RegExp('\\b' + className + '\\b');
  !reClass.test(elem.className) && (elem.className += ' ' + className);
}
```

### 请将数组的日期从前到后排序

```js
function sortDate(arr) {
  return arr.sort(function(date1, date2) {
    // 统一转换成 yyyy/MM/dd 的格式，兼容IE，否则new Date返回NaN
    date1 = date1.replace('-', '/');
    date2 = date2.replace('-', '/');
    return new Date(date1).getTime() - new Date(date2).getTime();
  });
}
```

### 写一个 getStyle()函数，获取 div 的边框粗细，并兼容所有浏览器

```js
function getStyle(elem, cssArr) {
  if (elem && elem.nodeType) {
    // border-top -> borderTop
    cssArr = typeof cssArr === 'string' ? camelCase(cssArr) : '';

    // 优先获取
    if (elem.style[cssArr]) return elem.style[cssArr];
    // for IE
    else if (elem.currentStyle) return elem.currentStyle[cssArr];
    // for w3c
    else if (document.defaultView && document.defaultView.getComputedStyle) {
      // borderTop -> border-top
      cssArr = cssArr.replace(/([A-Z])/g, '-$1').toLowerCase();

      var style = document.defaultView.getComputedStyle(elem, '');
      return style && style.getPropertyValue(cssArr);
    }
  }
  return null;
}
```
