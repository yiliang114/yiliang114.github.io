---
title: mobile
date: 2020-11-21
draft: true
---

### 1px 的边框问题

一般来说，在 PC 端浏览器中，设备像素比（dpr）等于 1，1 个 css 像素就代表 1 个物理像素；但是在 retina 屏幕中，dpr 普遍是 2 或 3，1 个 css 像素不再等于 1 个物理像素，因此比实际设计稿看起来粗不少。

1. 伪元素+scale

```html
<style>
  .box {
    width: 100%;
    height: 1px;
    margin: 20px 0;
    position: relative;
  }
  .box::after {
    content: '';
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 1px;
    transform: scaleY(0.5);
    transform-origin: 0 0;
    background: red;
  }
</style>

<div class="box"></div>
```

2. border-image

```css
div {
  border-width: 1px 0px;
  -webkit-border-image: url(border.png) 2 0 stretch;
  border-image: url(border.png) 2 0 stretch;
}
```

### 移动端布局的坑

https://www.bbsmax.com/A/xl56b4Ao5r/

### h5 键盘

window.onresize 事件来做突破点的，但是 ios 中软键盘的弹起收起并不触发 window.onresize 事件。
总结：

1. 在 ios 中软键盘弹起时，仅会引起\$(‘body’).scrollTop 值改变，但是我们可以通过输入框的获取焦点情况来做判断，但也只能在 ios 中采用这个方案，因为在 android 中存在主动收起键盘后，但输入框并没有失焦，而 ios 中键盘收起后就会失焦；
2. 在 android 中软键盘弹起或收起时，会改变 window 的高度，因此监听 window 的 onresize 事件；

#### Android

```js
//获取原窗口的高度
var originalHeight = document.documentElement.clientHeight || document.body.clientHeight;
window.οnresize = function () {
  //键盘弹起与隐藏都会引起窗口的高度发生变化
  var resizeHeight = document.documentElement.clientHeight || document.body.clientHeight;
  if (resizeHeight - 0 < originalHeight - 0) {
    //当软键盘弹起，在此处操作
  } else {
    //当软键盘收起，在此处操作
  }
};
```

#### ios

focusin 和 focusout 支持冒泡，对应 focus 和 blur, 使用 focusin 和 focusout 的原因是 focusin 和 focusout 可以冒泡，focus 和 blur 不会冒泡，这样就可以使用事件代理，处理多个输入框存在的情况。

```js
 document.body.addEventListener('focusin', () => {
            //软键盘弹出的事件处理
            if(isIphone()）{

            }
        })
  document.body.addEventListener('focusout', () => {
       //软键盘收起的事件处理
        if(isIphone()）{

        }
   })
```

### 用户页面遇到白屏问题，解决问题的思路

### 滑动穿透问题解决

### input 搜索如何防抖，如何处理中文输入

防抖就不说了，主要是这里提到的中文输入问题，其实看过 elementui 框架源码的童鞋都应该知道，elementui 是通过 compositionstart & compositionend 做的中文输入处理：
相关代码：

```html
<input
  ref="input"
  @compositionstart="handleComposition"
  @compositionupdate="handleComposition"
  @compositionend="handleComposition"
  \
/>
```

这 3 个方法是原生的方法，这里简单介绍下，官方定义如下 compositionstart 事件触发于一段文字的输入之前（类似于 keydown 事件，但是该事件仅在若干可见字符的输入之前，而这些可见字符的输入可能需要一连串的键盘操作、语音识别或者点击输入法的备选词）
简单来说就是切换中文输入法时在打拼音时(此时 input 内还没有填入真正的内容)，会首先触发 compositionstart，然后每打一个拼音字母，触发 compositionupdate，最后将输入好的中文填入 input 中时触发 compositionend。触发 compositionstart 时，文本框会填入 “虚拟文本”（待确认文本），同时触发 input 事件；在触发 compositionend 时，就是填入实际内容后（已确认文本）,所以这里如果不想触发 input 事件的话就得设置一个 bool 变量来控制。
[![image](https://user-images.githubusercontent.com/34699694/58140376-8f5e9580-7c71-11e9-987e-5fe39fce5e90.png)](https://user-images.githubusercontent.com/34699694/58140376-8f5e9580-7c71-11e9-987e-5fe39fce5e90.png)
根据上图可以看到

输入到 input 框触发 input 事件
失去焦点后内容有改变触发 change 事件
识别到你开始使用中文输入法触发**compositionstart **事件
未输入结束但还在输入中触发**compositionupdate **事件
输入完成（也就是我们回车或者选择了对应的文字插入到输入框的时刻）触发 compositionend 事件。

那么问题来了 使用这几个事件能做什么？
因为 input 组件常常跟 form 表单一起出现，需要做表单验证
[![image](https://user-images.githubusercontent.com/34699694/58140402-b1581800-7c71-11e9-97b9-9c696f3a0061.png)](https://user-images.githubusercontent.com/34699694/58140402-b1581800-7c71-11e9-97b9-9c696f3a0061.png)
为了解决中文输入法输入内容时还没将中文插入到输入框就验证的问题

我们希望中文输入完成以后才验证
