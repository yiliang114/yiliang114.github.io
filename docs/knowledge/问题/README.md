---
title: 技术驱动
date: 2020-11-21
aside: false
draft: true
---

### 项目问题

出现了什么问题，是怎么解决的

#### 开发环境热更新缓慢

现象： 做了简单的 router code split 之后，由于项目引入的资源过大，app.js 以及一些 chunk 还是达到了 10 几甚至 20 几 M ，导致在 dev 环境下 ， 页面刷新也很慢。（build 之后其实相对还好， 开启 gzip 之后也就几百 k）。刷新加载需要很多秒

分析：

导致 chunk 大有可能的原因：

1. 引入的包过多，多大。 最有可能的冗余包：
   1. ant icon
   2. moment.js
2. 代理的网络的原因，因为有时候本地加载开发资源时间是几百毫秒级别，有时候是好多秒，造成了开发阶段的体验很差。

确认自己的猜想：

1. vue ui 或者安装 webpack 的一个插件可视化查看造成 chunk 大的原因

解决方案:

1. 开发环境继续拆包
2. 编译缓存，hapack cache-loader 继续缓存被编译的部分，让热加载更新的部分只更新修改的部分（尽可能少）
3. 排查网络原因

### 可配置化的前端项目

1. json 中无法写函数，写的函数无法很好的注入 content 或者 this 之类的上下文，除非改造函数的写法，比如 vm => vm.data 之类的将 this 传入
   解决： 参考 vscode 中的 ui 可配置化，采用 when 的形式，对操作符进行处理，将 when 字符串拼接上 with(this) 执行的接口会被自动 return， 这样就可以直接写属性名的判断条件，而不用带上 this 之类的前缀

2. 随着项目的更新，旧的配置解析器慢慢显示出一些问题（项目初期设计不算太完善），但是线上已经有多个项目在跑了，新功能要加入旧解析器不能再很好的工作了。
   解决： 优雅降级，对于老的组件，额外开发一些 transfor 转换器，将新配置（可读性更好）的配置转化成旧配置进行渲染； 对于新组件，直接将新的配置文件进行解析渲染。

### 难点

##### console

1. 意图配置的 tag 输入框，多 tag 下拉框的位置计算
2. 页面跳转的处理，vuex 存储 next（）
3. 轮询接口的封装
4. requestId 捕捉器
5. vuex 的小封装

##### h5

1. 1px 那个问题，以前是直接通过 dpi 进行缩放，现在的解决是通过媒体查询，进行缩放
2. h5 的输入框、键盘的处理，安卓 ios 等等会有不同的表现
