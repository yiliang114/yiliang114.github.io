---
title: safety
date: 2020-11-21
draft: true
---

## 点击劫持

点击劫持是一种视觉欺骗的攻击手段。攻击者将需要攻击的网站通过 iframe 嵌套的方式嵌入自己的网页中，并将 iframe 设置为透明，在页面中透出一个按钮诱导用户点击。

对于这种攻击方式，推荐防御的方法有两种。

- X-FRAME-OPTIONS
- JS 防御

### X-FRAME-OPTIONS

`X-FRAME-OPTIONS` 是一个 HTTP 响应头，在现代浏览器有一个很好的支持。这个 HTTP 响应头 就是为了防御用 iframe 嵌套的点击劫持攻击。

该响应头有三个值可选，分别是

- `DENY`，表示页面不允许通过`iframe`的方式展示
- `SAMEORIGIN`，表示页面可以在相同域名下通过`iframe`的方式展示
- `ALLOW-FROM`，表示页面可以在指定来源的`iframe`中展示

### JS 防御

对于某些低版本浏览器来说，并不能支持上面的这种方式，那我们只有通过 JS 的方式来防御点击劫持了。

```html
<head>
  <style id="click-jack">
    html {
      display: none !important;
    }
  </style>
</head>
<body>
  <script>
    if (self == top) {
      var style = document.getElementById('click-jack');
      document.body.removeChild(style);
    } else {
      top.location = self.location;
    }
  </script>
</body>
```

## 中间人攻击

什么是中间人攻击？如何防范中间人攻击？

中间人攻击是攻击方同时与服务端和客户端建立起了连接，并让对方认为连接是安全的，但是实际上整个通信过程都被攻击者控制了。攻击者不仅能获得双方的通信信息，还能修改通信信息。

通常来说不建议使用公共的 Wi-Fi，因为很可能就会发生中间人攻击的情况。如果你在通信的过程中涉及到了某些敏感信息，就完全暴露给攻击方了。

当然防御中间人攻击其实并不难，只需要增加一个安全通道来传输信息。HTTPS 就可以用来防御中间人攻击，但是并不是说使用了 HTTPS 就可以高枕无忧了，因为如果你没有完全关闭 HTTP 访问的话，攻击方可以通过某些方式将 HTTPS 降级为 HTTP 从而实现中间人攻击。

## 密码安全

密码安全虽然大多是后端的事情，但是作为一名优秀的前端程序员也需要熟悉这方面的知识。

### 加盐

对于密码存储来说，必然是不能明文存储在数据库中的，否则一旦数据库泄露，会对用户造成很大的损失。并且不建议只对密码单纯通过加密算法加密，因为存在彩虹表的关系。

通常需要对密码加盐，然后进行几次不同加密算法的加密。

```js
// 加盐也就是给原密码添加字符串，增加原密码长度
sha256(sha1(md5(salt + password + salt)));
```

但是加盐并不能阻止别人盗取账号，只能确保即使数据库泄露，也不会暴露用户的真实密码。一旦攻击者得到了用户的账号，可以通过暴力破解的方式破解密码。对于这种情况，通常使用验证码增加延时或者限制尝试次数的方式。并且一旦用户输入了错误的密码，也不能直接提示用户输错密码，而应该提示账号或密码错误。

## 拒绝服务攻击

拒绝服务攻击（denial-of-service attack，DoS），亦称洪水攻击，其目的在于使目标电脑的网络或系统资源耗尽，使服务暂时中断或停止，导致其正常用户无法访问。

分布式拒绝服务攻击（distributed denial-of-service attack，DDoS），指攻击者使用两个或以上被攻陷的电脑作为“僵尸”向特定的目标发动“拒绝服务”式攻击。

**DDoS**

攻击者在短时间内发起大量请求，利用协议的缺点，耗尽服务器的资源，导致网站无法响应正常的访问。

我之前也经历过，在这篇[《被 DDos 后的及时补救与一些思考》](https://godbmw.com/passages/2018-11-06-ddos-recover-and-think/)

防范的措施，或者称之为补救措施更合适，有以下建议：

1. 借助云厂商 CDN：静态流量的资源还得自己掏钱
2. IP 黑/白名单：`nginx` 和 `apache` 都可以设置
3. HTTP 请求信息：根据 UserAgent 等字段的信息
4. 静态化：博客网站直接挂在 github 等平台上
5. 备份网站：阮一峰老师的网站被 ddos 的时候就有个备份页面
6. 其他：弹性 ip、免费的 DNSpod、国内外分流、高防 ip 等等

### 简要介绍一下 DNS 劫持？

DNS 劫持的话是指在用户请求过程的域名解析中，分析请求的域名，返回假的 IP 地址，使用户访问的是假的网址。

### 简要介绍一下 DNS 污染？

### 如何防范 Web 前端攻击？

- 不要信任任何外部传入的数据

  - 针对用户输入作相关的格式检查、过滤等操作

- 不要信任在任何传入的第三方数据

  - 使用 CORS，设置 Access-Control-Allow-Origin

- 更安全地使用 Cookie

  - 设置 Cookie 为 HttpOnly，禁止了 JavaScript 操作 Cookie

- 防止网页被其他网站内嵌为 iframe
  - 服务器端设置 X-Frame-Options 响应头，防止页面被内嵌

### 如何应对流量劫持

利用各种恶意软件修改浏览器、锁定主页或不停弹出新窗口，强制用户访问某些网站，从而造成用户流量损失的情形。流量劫持是一种古老的攻击方式，比如早已见惯的广告弹窗(如下图)等，很多人已经对此麻木，并认为流量劫持不会造成什么损失。而事实上，流量劫持可以通过多种你无法觉察的方式窃取信息!
流量劫持的方式有很多种，常见的主要有 DNS 劫持、CDN 入侵、网关劫持、ARP 攻击、Hub 嗅探等等

##### 劫持实现的手段

域名劫持：通过劫持掉域名的 DNS 解析结果，将 HTTP 请求劫持到特定 IP 上，使得客户端和攻击者的服务器建立 TCP 连接，而不是和目标服务器直接连接，这样攻击者可以对内容进行窃取或篡改。在极端的情况下甚至攻击者可能伪造目标网站页面进行钓鱼攻击。

直接流量修改：在数据通路上对页面进行固定的内容插入，比如广告弹窗等。在这种情况下，虽然客户端和服务器是直接建立的连接，但是数据内容依然可能遭到野蛮破坏

#### 阻止劫持手段

##### 限制网站权限

部分网站遭遇劫持主要由于非法服务器获取了 Web 网站文件及文件夹的读写权限，针对这个问题，我们可以利用服务器的安全设置、提高网站程序的安全性，以此防范 Web 劫持。

##### 提升网站 防 SQL 注入功能

SQL 注入通过利用 SQL 语言的特性，向 Web 数据库写入内容，获取权限，因此我们需要针对 MS SQL Server 数据库中的小权限 sa 默认用户，建立一个只能访问本系统数据库的专一用户，并且为他配置最小权限。

##### 配置 Web 站点文件夹及其操作权限

使用 Windows 系统中的超级管理员权限对 Web 站点文件和文件夹进行权限配置。将大部分人的权限配置为仅读权限，黑客在没有写权限的情况下，很难将木马程序植入，减少网站域名劫持的可能性。

##### 定期清理 Web 网点中存在的可疑文件

不管黑客通过何种方式获取权限，在事件管理器中都会显示出异常情况，通过对异常事件和日期的分析，查看执行代码文件中是否被人注入代码或改动，并且对新增可执行代码进行清理。

##### 使用公共 114DNS

让用户绕过运营商 local DNS，使用 114 DNS（国内最大的中立缓存 DNS），这种在技术实现上有比较大的难度，成本也比较高。在现在的情况下即使用户使用公共 DNS，也并不能完全解决问题。先不论公共 DNS 是否也有在做劫持，最关键的是，运营商也会专门针对到公共 DNS 的流量做劫持。对于流量入口的把控，运营商不会放松警惕。

##### HttpDNS，防止 DNS 劫持

在移动客户端中加入一个域名解析模块，客户端通过 HTTP 的方式向网站的流量调度服务器请求 IP，流量调度服务器会根据用户所在位置给用户一个最优的 IP。客户端在获取 IP 后直接用此 IP 来访问所需站点资源
![image](https://user-images.githubusercontent.com/21194931/56857931-8695df00-69a5-11e9-801c-b69bc660ecc8.png)

##### HTTPS 防劫持

由于公共 DNS、HttpDNS 的部署成本过高，有一定的技术难度，并且在面对无孔不入的 DNS 劫持时难免会力有不逮。这时候网站开启 HTTPS 作为防流量劫持手段之一可以高效的解决这些问题。目前绝大部分网站也都已经启用 HTTPS 来加密。HTTPS 协议就是 HTTP+SSL/TLS，在 HTTP 的基础上加入 SSL /TLS 层，提供了内容加密、身份认证和数据完整性三大功能，最终目的就是为了加密数据，用于安全的数据传输
![image](https://user-images.githubusercontent.com/21194931/56857932-8dbced00-69a5-11e9-8e8a-5c0f1d0ad3b9.png)
![image](https://user-images.githubusercontent.com/21194931/56857935-91507400-69a5-11e9-9125-c3cf0108bdc8.png)

##### 如何快速启用 HTTPS

鉴于启用 HTTPS 会带来一定的服务器资源消耗，目前大多数公司普遍的选择是直接使用国内的 CDN 服务，比如又拍云提供一站式 HTTPS 服务，简单几步就能完成全站 HTTPS 的部署，光是免费类证书就有 2 款，而付费证书在 3-5 天内即可完成申购。另外一种可以直接在 Web 服务器上部署证书和私钥，可以去网上查看教程。

#### 总结

面对 Web 流量劫持，首先我们可以在网站层面限制读写权限，限制恶意代码的写入，其次可以通过公有 DNS 和 HttpDNS 来防止恶意 DNS 劫持。全站开启 HTTPS，加密数据传输，可以有效防止数据泄漏，同时解决流量劫持的问题

### 接口如何防刷

referer 校验
UA 校验
频率限制（1s 内接口调用次数限制）
把某个 key 加配料，带上时间戳，加密，请求时带上，过期或解密失败则 403。
