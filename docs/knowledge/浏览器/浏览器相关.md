---
title: 懒加载的实现原理
date: '2020-10-26'
draft: true
---

### 浏览器页面有哪三层构成，分别是什么，作用是什么?

构成：结构层、表示层、行为层
分别是：HTML、CSS、JavaScript
作用：HTML 实现页面结构，CSS 完成页面的表现与风格，JavaScript 实现一些客户端的功能与业务。

### 浏览器同一时间可以从一个域名下载多少资源？

浏览器的并发请求数目限制是针对同一域名的。

目前，所有浏览器的并发数目一般限制在 10 以内。
chrome、opera、firefox、IE8+ 等大概为 6 个，IE6 2 个，IE7 是 4 个。

### 页面可见性（Page Visibility API） 可以有哪些用途？

- 在页面被切换到其他后台进程的时候，自动暂停音乐或视频的播放
- 当用户浏览其他页面，暂停网站首页幻灯自动播放
- 完成登陆后，无刷新自动同步其他页面的登录状态
- 通过 visibilityState 的值检测页面当前是否可见，以及打开网页的时间等;

### formdata 的了解

### document 中的`load`事件和`DOMContentLoaded`事件之间的区别是什么？

当初始的 HTML 文档被完全加载和解析完成之后，`DOMContentLoaded`事件被触发，而无需等待样式表、图像和子框架的完成加载。

`window`的`load`事件仅在 DOM 和所有相关资源全部完成加载后才会触发。

### 为什么要使用`load`事件？这个事件有什么缺点吗？你知道一些代替方案吗，为什么使用它们？

在文档装载完成后会触发`load`事件。此时，在文档中的所有对象都在 DOM 中，所有图像、脚本、链接和子框架都完成了加载。

DOM 事件`DOMContentLoaded`将在页面的 DOM 构建完成后触发，但不要等待其他资源完成加载。如果在初始化之前不需要装入整个页面，这个事件是使用首选。

### 为什么 JS 要放到 body 尾部？

如果 JS 需要绑定操作 DOM，那么放在 header 中如果处理不当就不会绑定到 DOM

**JS 引擎是独立于渲染引擎存在的。**我们的 JS 代码在文档的何处插入，就在何处执行。当 HTML 解析器遇到一个 script 标签时，它会暂停渲染过程，将控制权交给 JS 引擎。JS 引擎对内联的 JS 代码会直接执行，对外部 JS 文件还要先获取到脚本、再进行执行。等 JS 引擎运行完毕，浏览器又会把控制权还给渲染引擎，继续 CSSOM 和 DOM 的构建。

浏览器之所以让 JS 阻塞其它的活动，是因为它不知道 JS 会做什么改变，担心如果不阻止后续的操作，会造成混乱。

结论：

- 如果 JS 在 header 中，浏览器会阻塞并等待 JS 加载完毕并执行
- 如果 JS 在 body 尾部，览器会进行一次提前渲染，从而提前首屏出现时间

### Javascript 无阻塞加载具体方式

- **将脚本放在底部。**`<link>`还是放在`head`中，用以保证在`js`加载前，能加载出正常显示的页面。`<script>`标签放在`</body>`前。
- **成组脚本**：由于每个`<script>`标签下载时阻塞页面解析过程，所以限制页面的`<script>`总数也可以改善性能。适用于内联脚本和外部脚本。

* **非阻塞脚本**：等页面完成加载后，再加载`js`代码。也就是，在`window.onload`事件发出后开始下载代码。
  （1）`defer`属性：支持 IE4 和`fierfox3.5`更高版本浏览器
  （2）动态脚本元素：文档对象模型（DOM）允许你使用 js 动态创建`HTML`的几乎全部文档内容。代码如下：

<br>

```html
<script>
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'file.js';
  document.getElementsByTagName('head')[0].appendChild(script);
</script>
```

此技术的重点在于：无论在何处启动下载，文件额下载和运行都不会阻塞其他页面处理过程。即使在 head 里（除了用于下载文件的 http 链接）。

### js 如何判断网页中图片加载成功或者失败

使用 onload 事件运行加载成功，使用 onerror 事件判断失败
