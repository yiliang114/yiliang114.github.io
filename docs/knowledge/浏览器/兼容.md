---
title: 懒加载的实现原理
date: '2020-10-26'
draft: true
---

### 为何会出现浏览器兼容问题

同一产品，版本越老 bug 越多
同一产品，版本越新，功能越多
不同产品，不同标准，不同实现方式
处理兼容问题的思路

1. 要不要做
   产品的角度（产品的受众、受众的浏览器比例、效果优先还是基本功能优先）
   成本的角度 (有无必要做某件事)

2. 做到什么程度 _ 让哪些浏览器支持哪些效果 3.如何做 根据兼容需求选择技术框架/库(jquery) 根据兼容需求选择兼容工具(html5shiv.js、respond.js、css reset、normalize.css、Modernizr) _ 条件注释、CSS Hack、js 能力检测做一些修补

### 列举 IE 与其他浏览器不一样的特性？

1. IE 的排版引擎是 Trident （又称为 MSHTML）
2. Trident 内核曾经几乎与 W3C 标准脱节（2005 年）
3. Trident 内核的大量 Bug 等安全性问题没有得到及时解决
4. JS 方面，有很多独立的方法，例如绑定事件的 attachEvent、创建事件的 createEventObject 等
5. CSS 方面，也有自己独有的处理方式，例如设置透明，低版本 IE 中使用滤镜的方式
6. IE 支持`currentStyle`，Firefox 使用`getComputedStyle`
7. IE 使用`innerText`，Firefox 使用`textContent`
8. 滤镜方面：IE:`filter:alpha(opacity= num)`；Firefox：`-moz-opacity:num`
9. 事件方面：IE：`attachEvent`：火狐是`addEventListener`
10. 鼠标位置：IE 是`event.clientX`；火狐是`event.pageX`
11. IE 使用`event.srcElement`；Firefox 使用`event.target`
12. IE 中消除 list 的原点仅需 margin:0 即可达到最终效果；FIrefox 需要设置`margin:0;padding:0以及list-style:none`
13. CSS 圆角：ie7 以下不支持圆角
14. IE 的渲染引擎是 Trident 与 W3C 标准差异较大：例如盒子模型的怪异模式
15. JS 方面有很多独立的方法，例如事件处理不同：绑定/删除事件，阻止冒泡，阻止默认事件等
16. CSS 方面也有自己独有的处理方式，例如设置透明，低版本 IE 中使用滤镜的方式
17. 事件不同之处：

- 触发事件的元素被认为是目标（target）。而在 IE 中，目标包含在 event 对象的 srcElement 属性；
- 获取字符代码、如果按键代表一个字符（shift、ctrl、alt 除外），IE 的 keyCode 会返回字符代码（Unicode），DOM 中按键的代码和字符是分离的，要获取字符代码，需要使用 charCode 属性；
- 阻止某个事件的默认行为，IE 中阻止某个事件的默认行为，必须将 returnValue 属性设置为 false，Mozilla 中，需要调用 preventDefault() 方法；
- 停止事件冒泡，IE 中阻止事件进一步冒泡，需要设置 cancelBubble 为 true，Mozzilla 中，需要调用 stopPropagation()；

#### ajax 在 IE 下的问题？

IE 缓存问题：

在 IE 浏览器下，如果请求的方法是`GET`，并且请求的`URL`不变，那么这个请求的结果就会被缓存。解决这个问题的办法可以通过实时改变请求的`URL`，只要 URL 改变，就不会被缓存，可以通过在 URL 末尾添加上随机的时间戳参数(`'t'= + new Date().getTime()`)

或者：

```js
open('GET', 'demo.php?rand=' + Math.random(), true); //
```

Ajax 请求的页面历史记录状态问题:

可以通过锚点来记录状态，`location.hash`。让浏览器记录 Ajax 请求时页面状态的变化。
还可以通过`HTML5`的`history.pushState`，来实现浏览器地址栏的无刷新改变

#### 常见兼容性问题？

- png24 位的图片在 iE6 浏览器上出现背景，解决方案是做成 PNG8.也可以引用一段脚本处理.
- 浏览器默认的 margin 和 padding 不同。解决方案是加一个全局的\*{margin:0;padding:0;}来统一。
- IE6 双边距 bug:块属性标签 float 后，又有横行的 margin 情况下，在 ie6 显示 margin 比设置的大。
- 浮动 ie 产生的双倍距离（IE6 双边距问题：在 IE6 下，如果对元素设置了浮动，同时又设置了 margin-left 或 margin-right，margin 值会加倍。）
- #box{ float:left; width:10px; margin:0 0 0 100px;}
- 这种情况之下 IE 会产生 20px 的距离，解决方案是在 float 的标签样式控制中加入
- *display:inline;将其转化为行内属性。(*这个符号只有 ie6 会识别)
- 渐进识别的方式，从总体中逐渐排除局部。
  首先，巧妙的使用“\9”这一标记，将 IE 游览器从所有情况中分离出来。
  接着，再次使用“+”将 IE8 和 IE7、IE6 分离开来，这样 IE8 已经独立识别。

  ```css
  .bb {
    background-color: #f1ee18; /*所有识别*/
    .background-color: #00deff\9; /*IE6、7、8识别*/

    +background-color: #a200ff; /*IE6、7识别*/
    _background-color: #1e0bd1; /*IE6识别*/
  }
  ```

- 怪异模式问题：漏写 DTD 声明，Firefox 仍然会按照标准模式来解析网页，但在 IE 中会触发
- 怪异模式。为避免怪异模式给我们带来不必要的麻烦，最好养成书写 DTD 声明的好习惯。现在
- 可以使用[html5](http://www.w3.org/TR/html5/single-page.html)推荐的写法：`<doctype html>`
- 上下 margin 重合问题
  - ie 和 ff 都存在，相邻的两个 div 的 margin-left 和 margin-right 不会重合，但是 margin-top 和 margin-bottom 却会发生重合。
  - 解决方法，养成良好的代码编写习惯，同时采用 margin-top 或者同时采用 margin-bottom。

### 经常遇到的浏览器兼容性有哪一些，原因，解决的方法是什么？常用的 hack 技巧

### 常见浏览器兼容性问题与解决方案？

1. 浏览器兼容问题一：不同浏览器的标签默认的外补丁和内补丁不同
   问题症状：随便写几个标签，不加样式控制的情况下，各自的 margin 和 padding 差异较大。
   碰到频率:100%
   解决方案：CSS 里 *{margin:0;padding:0;}
   备注：这个是最常见的也是最易解决的一个浏览器兼容性问题，几乎所有的 CSS 文件开头都会用通配符*来设置各个标签的内外补丁是 0。
2. 浏览器兼容问题二：块属性标签 float 后，又有横行的 margin 情况下，在 IE6 显示 margin 比设置的大
   问题症状:常见症状是 IE6 中后面的一块被顶到下一行
   碰到频率：90%（稍微复杂点的页面都会碰到，float 布局最常见的浏览器兼容问题）
   解决方案：在 float 的标签样式控制中加入 display:inline;将其转化为行内属性
   备注：我们最常用的就是 div+CSS 布局了，而 div 就是一个典型的块属性标签，横向布局的时候我们通常都是用 div float 实现的，横向的间距设置如果用 margin 实现，这就是一个必然会碰到的兼容性问题。
3. 浏览器兼容问题三：设置较小高度标签（一般小于 10px），在 IE6，IE7，遨游中高度超出自己设置高度
   问题症状：IE6、7 和遨游里这个标签的高度不受控制，超出自己设置的高度
   碰到频率：60%
   解决方案：给超出高度的标签设置 overflow:hidden;或者设置行高 line-height 小于你设置的高度。
   备注：这种情况一般出现在我们设置小圆角背景的标签里。出现这个问题的原因是 IE8 之前的浏览器都会给标签一个最小默认的行高的高度。即使你的标签是空的，这个标签的高度还是会达到默认的行高。
4. 浏览器兼容问题四：行内属性标签，设置 display:block 后采用 float 布局，又有横行的 margin 的情况，IE6 间距 bug
   问题症状：IE6 里的间距比超过设置的间距
   碰到几率：20%
   解决方案 ： 在 display:block;后面加入 display:inline;display:table;
   备注：行内属性标签，为了设置宽高，我们需要设置 display:block;(除了 input 标签比较特殊)。在用 float 布局并有横向的 margin 后，在 IE6 下，他就具有了块属性 float 后的横向 margin 的 bug。不过因为它本身就是行内属性标签，所以我们再加上 display:inline 的话，它的高宽就不可设了。这时候我们还需要在 display:inline 后面加入 display:talbe。
5. 浏览器兼容问题五：图片默认有间距
   问题症状：几个 img 标签放在一起的时候，有些浏览器会有默认的间距，加了问题一中提到的通配符也不起作用。
   碰到几率：20%
   解决方案：使用 float 属性为 img 布局
   备注 ： 因为 img 标签是行内属性标签，所以只要不超出容器宽度，img 标签都会排在一行里，但是部分浏览器的 img 标签之间会有个间距。去掉这个间距使用 float 是正道。（我的一个学生使用负 margin，虽然能解决，但负 margin 本身就是容易引起浏览器兼容问题的用法，所以我禁止他们使用）
6. 浏览器兼容问题六：标签最低高度设置 min-height 不兼容
   问题症状：因为 min-height 本身就是一个不兼容的 CSS 属性，所以设置 min-height 时不能很好的被各个浏览器兼容
   碰到几率：5%
   解决方案：如果我们要设置一个标签的最小高度 200px，需要进行的设置为：{min-height:200px; height:auto !important; height:200px; overflow:visible;}
   备注：在 B/S 系统前端开时，有很多情况下我们又这种需求。当内容小于一个值（如 300px）时。容器的高度为 300px；当内容高度大于这个值时，容器高度被撑高，而不是出现滚动条。这时候我们就会面临这个兼容性问题。
7. 浏览器兼容问题七：透明度的兼容 CSS 设置
   一般在 ie 中用的是 filter:alpha(opacity=0);这个属性来设置 div 或者是块级元素的透明度，而在 firefox 中，一般就是直接使用 opacity:0,对于兼容的，一般的做法就是在书写 css 样式的将 2 个都写上就行，就能实现兼容

### html 常见兼容性问题？

1.  png24 位的图片在 iE6 浏览器上出现背景
    解决方案：做成 PNG8，也可以引用一段脚本处理.

2.  浏览器默认的 margin 和 padding 不同
    解决方案：加一个全局的 \*{margin:0;padding:0;} 来统一。

3.  IE6 双边距 bug：在 IE6 下，如果对元素设置了浮动，同时又设置了 margin-left 或 margin-right，margin 值会加倍。

        	`#box{ float:left; width:10px; margin:0 0 0 10px;}`

    这种情况之下 IE 会产生 20px 的距离
    解决方案：在 float 的标签样式控制中加入 _display:inline; 将其转化为行内属性。( _ 这个符号只有 ie6 会识别)

4.  渐进识别的方式，从总体中逐渐排除局部。
    首先，巧妙的使用“\9”这一标记，将 IE 游览器从所有情况中分离出来。
    接着，再次使用 "+" 将 IE8 和 IE7、IE6 分离开来，这样 IE8 已经独立识别。

    ```
    .bb{
        background-color:#f1ee18; /*所有识别*/
        .background-color:#00deff\9; /*IE6、7、8识别*/
        +background-color:#a200ff; /*IE6、7识别*/
        _background-color:#1e0bd1; /*IE6识别*/
    }
    ```

5.  IE 下，可以使用获取常规属性的方法来获取自定义属性，也可以使用 getAttribute() 获取自定义属性；Firefox 下,只能使用 getAttribute()获取自定义属性
    解决方法：统一通过 getAttribute()获取自定义属性

6.  IE 下，event 对象有 x、y 属性，但是没有 pageX、pageY 属性; Firefox 下，event 对象有 pageX、pageY 属性，但是没有 x、y 属性
    解决方法：（条件注释）缺点是在 IE 浏览器下可能会增加额外的 HTTP 请求数。

7.  Chrome 中文界面下默认会将小于 12px 的文本强制按照 12px 显示
    解决方法：可通过加入 CSS 属性 -webkit-text-size-adjust: none; 解决， 但是，在 chrome 更新到 27 版本之后就不可以用了。-webkit-transform : scale() 需要通过这个 css 属性来处理。

8.  超链接访问过后 hover 样式就不出现了，被点击访问过的超链接样式不在具有 hover 和 active 了
    解决方法：改变 CSS 属性的排列顺序 L-V-H-A

        	a:link {}
        	a:visited {}
        	a:hover {}
        	a:active {}

9.  怪异模式问题：漏写 DTD 声明，Firefox 仍然会按照标准模式来解析网页，但在 IE 中会触发怪异模式。为避免怪异模式给我们带来不必要的麻烦，最好养成书写 DTD 声明的好习惯。推荐的写法：<!DOCTYPE html>

10. 上下 margin 重合问题：ie 和 ff 都存在，相邻的两个 div 的 margin-left 和 margin-right 不会重合，但是 margin-top 和 margin-bottom 却会发生重合。
    解决方法：养成良好的代码编写习惯，同时采用 margin-top 或者同时采用 margin-bottom。

11. ie6 对 png 图片格式支持不好
    解决方案：引用一段脚本处理

### 低版本浏览器不支持 html5 标签如何解决

用 js 使低版本浏览器支持 html5 标签底层是怎么实现的

#### 怎么在 IE8 及以下实现 HTML5 的兼容？

https://github.com/haizlin/fe-interview/issues/502

### IE 的事件处理和 W3C 的事件处理有哪些区别？

绑定事件

- W3C: targetEl.addEventListener('click', handler, false);
- IE: targetEl.attachEvent('onclick', handler);

删除事件

- W3C: targetEl.removeEventListener('click', handler, false);
- IE: targetEl.detachEvent(event, handler);

事件对象

- W3C: var e = arguments.callee.caller.arguments[0]
- IE: window.event

事件目标

- W3C: e.target
- IE: window.event.srcElement

阻止事件默认行为

- W3C: e.preventDefault()
- IE: window.event.returnValue = false'

阻止事件传播

- W3C: e.stopPropagation()
- IE: window.event.cancelBubble = true

### Chrome 低版本 以及 firefox event 的区别

https://caniuse.com/#search=event
https://forum.uipath.com/t/chrome-extension-is-not-working-with-chrome-64-bit-v63-and-v64/24494
https://blog.csdn.net/u012317188/article/details/79031327
https://blog.csdn.net/qq_19426793/article/details/77692984

### FF 和 Chrome window.event 事件的兼容性处理，点击、输入事件

### firefox 浏览器兼容性

https://www.cnblogs.com/zlp520/p/4717866.html

### 搜狗浏览器缺少 scrollTo 的 api

### 说说 fetch 的兼容性。

### webSocket 如何兼容低浏览器？

- Adobe Flash Socket
- ActiveX HTMLFile (IE)
- 基于 multipart 编码发送 XHR
- 基于长轮询的 XHR

### 经常遇到的浏览器的 JS 兼容性有哪些？解决方法是什么？

- 当前样式：getComputedStyle(el, null) VS el.currentStyle
- 事件对象：e VS window.event
- 鼠标坐标：e.pageX, e.pageY VS window.event.x, window.event.y
- 按键码：e.which VS event.keyCode
- 文本节点：el.textContent VS el.innerText
