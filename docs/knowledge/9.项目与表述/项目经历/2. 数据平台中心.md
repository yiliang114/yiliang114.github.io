---
title: 数据平台中心
date: 2020-11-21
draft: true
---

## 数据平台中心

1. 平台整个工作链路
2. 介绍高管驾驶舱

平台：

1. 报表
2. 工作表
3. 维表
4. 仪表盘 PC/Mobile

数据应用：

1. 驾驶舱
2. 行业经分
3. 产品分析
4. 客户分析
5. 销售看板
6. 月度经营分析等。。

数据工具：

1. 数据资产
2. 小程序
3. 仪表盘移动端

前端库包：

1. cdata-cli
2. cdata-utils
3. material
4. t1
5. cdata-bot
6. cdata-plugin

组件库：

1. vue 组件库， pc + mobile

### Low Code 数据工厂

可配置化的前端项目

1. json 中无法写函数，写的函数无法很好的注入 content 或者 this 之类的上下文，除非改造函数的写法，比如 vm => vm.data 之类的将 this 传入
   解决： 参考 vscode 中的 ui 可配置化，采用 when 的形式，对操作符进行处理，将 when 字符串拼接上 with(this) 执行的接口会被自动 return， 这样就可以直接写属性名的判断条件，而不用带上 this 之类的前缀

2. 随着项目的更新，旧的配置解析器慢慢显示出一些问题（项目初期设计不算太完善），但是线上已经有多个项目在跑了，新功能要加入旧解析器不能再很好的工作了。
   解决： 优雅降级，对于老的组件，额外开发一些 transfor 转换器，将新配置（可读性更好）的配置转化成旧配置进行渲染； 对于新组件，直接将新的配置文件进行解析渲染。

1) 可视化组件库的规范？？？

搭建系统 https://github.com/MrXujiang/h5-Dooring

手写 json 配置。

TODO: 以 STAR 法介绍这个项目。

#### TODO: 重点原理

- 前端： 基于 vue JSX + 自定义的 JSON Schema 规范。分为 ui 和 dataOptions 属性，分别对应 ui 和取数逻辑。
  - 组件库的处理。 vant + echarts + table + 自定义的图表组件。
- Node: 基于 SQL 语法定义的自定义 JSON Schema 搜索语句。
  - worksheetId 数据源
  - Filters 筛选
  - Configs 小计
  - Variables 条件配置

#### 与其他业界的 low code 项目的区别在哪里？

#### 高管驾驶舱

- vue
- 可视化
- echart
- 通过 json 配置文件生成目录结构
- 小程序 + webview

#### renderChild

一个主 Vue 实例渲染所有组件的形式。

问题：

1. 最大的问题之一， bff 层的对接，不是直连后台服务。解决方式： 手动填入数据，或者接口
2. 组件生态不够好，设计师设计稿很好看，前期组件沉淀还不够，不能够迅速搭建起移动端页面。
3. 传统的可视化搭建系统存在的最大问题是，基本上都是单个页面的，比如活动页，表单收集页等，因为路由切换、多页数据共享等逻辑会与传统可搭建系统的纯粹性产生冲突，当然也不排除一些业务本身的场景比较简单。从编译的角度上来做的 搭建系统就可以解决这个问题，所谓的搭建，其实就是在写 dom json 。

#### 数据可视化前端 + 数据中台

1. 可视化的页面搭建，云凤蝶 等平台，直接拿页面上的 ui 拖动来搭建。最终输出是一个 json 配置文件。
   难点：

   1. pc 上的操作交互
   2. ui 数据格式的定义
   3. 丰富的组件库支持

2. （可视化场景的落地）获取到 json 配置文件之后，能够根据配置文件直接渲染生成一个项目，一般以 h5 为主。
   难点：

   1. 输出除了 h5 还有 小程序和 pc 端
   2. 组件库三端都需要有，并且最好需要能够高度统一
   3. 同构：多端编译的框架，至少是 h5 到小程序一套代码实现。pc 端与 h5 的区别一般只是在于布局样式等等。

3. 基础建设：

   1. pc 端组件库
   2. 小程序组件库
   3. 移动端组件库

4. 监控上报： 自己配置仪表盘，自己分析数据
5. 脚手架

   1. 移动端、小程序、pc
   2. 微前端方案
   3. eslint, commitLint, code split, 内置组件库等等
   4. 提交代码， pr 以及发布流程的规范。
   5. 单元测试

6. 通用组件的沉淀（非 UI）

   1. ts + axios
   2. 数据接口的定义

7. 数据可视化 UI 的深入

   1. svg canvas 等底层
   2. echart antv 等

8. 数据中台
   1. 数据处理
   2. 网关层
   3. 数据缓存
   4. 权限
   5. TS 接入

#### Iframe 自适应高度

- 同域
- 跨域

##### postMessage

1. 子 iframe 页面只能调用 top.postMessage. 不能调用 parent.postMessage 的原因 ？
2. 父页面往子 iframe 发送事件，可以拿 iframe 的 dom 节点的 contentWindow 调用 postMessage 事件。但是父页面不知道子页面什么时候加载完毕，只能退而求其次，先让子 iframe 发送事件给父页面之后，通过 event.source 调用 postMessage 节点发送消息。 虽然实际上是同一个引用。
