---
title: 统一 CI/CD 流程与工程化
date: 2020-11-21
draft: true
---

## 统一 CI/CD 流程与工程化

- eslint/prettier
- commit message lint
- 前端、node 发布流程
- 与企业微信的流程打通，监控与通知的桥接。

### 工程化方面

前端工程化方面做了哪些东西?

1. 前端项目标准？
   表现为库的选择？文件划分目录的规定？pc、mobile 多端实践？ssr 方案集成？
2. 组件库集成？
   组件库建设的目的？npm 包的发布？
3. 脚手架工具？
   webpack 编译优化？webpack 打包构建优化？自我脚手架的工具使用？
4. git 提交规范 commit-msg？代码检查规范 eslint？
5. 前端性能监控？前端异常监控？前端用户埋点 sdk？
6. rap？jenkins？

### CI 流程

- 本地开发（developing）
- 静态代码检查（linting）
- 单元测试（testing）
- 合并进入主干（merging）
- 自动构建（building）
- 自动发布（publishing）
- 可以支持快速回滚。

代码合并进主干以后，就可以进行自动构建和发布了。

### Eslint 的配置

为了遵循代码规范，使用 eslint 是必不可少的，配置 eslint 有两种方式

1. 使用 eslintrc.js 配置文件
2. 通过 eslint-loader 的配置

为了提升团队的代码规范，也可以通过 git 的钩子，在代码提交时就对代码作出 eslint 检查

#### 前端工程化

1. 前端工程化
2. 统一的 git eslint 发布（oci）流程等

semantic-release 集成
https://zqblog.beaf.tech/semantic-release/ 主题的开关

自动化 release 流程 https://blog.amowu.com/2017/01/how-to-automate-js-release.html

#### git 开发、发布流程

1. 分支
2. 前端 oci 发布
3. node oci 发布

#### 分支

- feature 开发分支。提交，自动 test， 自动提交 pr 到 dev 分支。
- dev 发布分支。 合并，test， 自动部署。 自动跑 changelog。
- master 归档分支。 合并，自动 tag 和 release

#### eslint

#### vscode 格式化代码

eslint
prettier
vetur

三者会互相影响。 默认情况下 prettier 的配置信息不够灵活而且条数不够，例如对于箭头函数要不要加括号的问题，eslint 是可以针对不同情况的，是否有 {} 等，但是 prettier 只能设置 never 或者 always； 关闭 vscode 的 prettier 插件之后，实际上只要项目中还存在 prettier 配置文件的话，vetur 格式化 js 语言的格式，默认也会是 prettier 规则，所以还需要将 vetur 中的规则修改为 none

#### 可回滚

5 分钟的可回滚。需要保证的是用户端的是否生效，而不是点一下回滚的按钮的时间。

#### CI/CD 流程

ci(持续构建)
代码提交后触发自动化的单元测试，代码预编译，构建镜像，上传镜像等．

cd(持续发布)
持续发布则指将构建好的程序发布到各种环境，如预发布环境，正式环境

**oci 发布管理**

- feature-xxx 分支作为日常的开发分支。 pr 合入 dev 发布测试环境

- dev 分支对应测试环境
- preview 分支对应预发环境
- release 分支对应正式环境

- dev 分支 pr 到 preview
- preview 分支 pr 到 release
- master 分支不作修改，仅仅作为当前线上最新可运行的最新副本

- release 分支发布成功之后，自动打 tag 然后自动合入 master 分支中
- hotfix 分支从 release master 或者 tag 中拉出来，需要重新 dev 分支开始合并

#### CI 持续集成

- ars 平台
- qci + ars
- 蓝盾 + ars
- oci

规范： git commit, 分支, 单元测试, 发布等

#### ci cd 的迭代历史

1. 手动 rz
2. ars 平台， 手动 build
3. qci + ars
4. 蓝盾 一开始不支持前端，界面操作
5. oci
