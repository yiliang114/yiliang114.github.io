---
title: 数据平台中心
date: 2020-11-21
draft: true
---

## 大数据开发的流程

1. http 上报数据到 tdbank。收入数据的流水，上报到计费中心。如何到 tdbank 的？tdbank 上创建一个业务，通过调用提供的 api， 返回一个 ip 和端口，直接 post 指定的接口即可。
2. tdw 就是一个数据计算平台 ？？？ 现在都是在 idex 平台上进行开发测试的？ 管理脚本内容？
3. idex 平台创建 pysql 脚本，idx 在线平台写 py, SQL 在测试库中写代码。上传至 US 调度平台 us 平台。idex 只管查询的平台， us 是只管调度的平台。
4. us 上主要是新建任务、任务补录，任务之间的关联、先后关系。 洛子任务，只管调度，定时执行 py 脚本。 包含任务的新建、补录。 任务之前会存在一些关联关系，比如小周期依赖大周期，时间先后等。新建视图和任务，设置依赖关联类型等。任务之间可通过连线关联来设置父子任务的依赖关系，目前有 5 种周期类型：月、周、天、小时、分钟和 1 种“非周期”类型：
   1. 大周期依赖小周期
   2. 小周期依赖大周期
   3. 同周期依赖
   4. 周期（非周期）任务依赖非周期（周期）任务
   5. 自依赖
5. us 平台，也就是以前的洛子平台上，数据仓库的同学，需要针对不同维度，开发 py 脚本，写一些定时任务、表的关联处理等操作将数据插入到 tdw 表中去。？？
6. us 上还会有任务，将 tdw 表的数据，再次经过处理之后，出库到 pg, mysql 等结果库中，成为一张张的报表。这些报表，是会有权限的，在罗盘的报表平台上能够进行管理。
7. 工作表：将报表或者结果库中的表？做成一张张的工作表，会做一些额外的处理，比如说加上一些计算字段，多表关联等，处理成一张最终所需的大表。
8. 仪表盘：将工作表配成一张张仪表盘。 仪表盘可以直接拉出工作表的所有字段名，通过拖拽的形式，指定指标和维度，以及需要渲染的图形，再加上一些筛选条件之后。 筛选条件，会是动态拼接成 sql，（这种根据字段和条件来拼接 sql 的逻辑本来就有沉淀了，所以这也是为什么驾驶舱的 node 会这么进行处理） 做一个取数操作，当然这里是有权限的。配置的数据库（mysql）会保存图表的配置信息，数据从一些结果库筛选出来，或者调用结果库上层封装的数据底座的接口，做了一个渲染操作。这就是仪表盘。
9. 推送：将仪表盘或者图表（？？？） 先用 ssr 做渲染了将内容直接存入 CKV （redis） 中，每天定时跑完 ssr 之后，发送邮件，或者推送企业微信。

## 数仓的痛点

1. 开发人员水平有差距，对于建表规范、字段属性的命名等，会造成最终建表的质量存在差异。建表不规范、建表流程优化。
2. 建表过程重复，全部都需要通过写 py, sql 脚本来建表，对一些字段的枚举、注释、格式等，通过文档沉淀来管理的形式，繁琐且不能保证不出错。修改、同步表结构等操作，也需要通过 py, sql 来，权限大的人没时间，权限小的人不专业、做不了，风险太大。
3. 字段、表结构等信息，权限没法把控，落到人身上。
4. 系统、业务升级（例如组织架构变化之后，汇报产品、人员变化了），很可能会涉及到一系列表结构的变化、或者老表弃用等。没有表的血缘关系，就会比较痛苦。
5. 业务升级，一些库表的字段、结构同步问题。 可视化显示字段与字段，和各个表之前的血缘关系。怎么拿到血缘关系的？
6. 字段、表（包括 tdw 表与结果库表） 的权限管理，只能负责人建。
7. 新建表、复制表等 都需要通过 sql 脚本，数据资产平台能够直接筛选字段，拖拽顺序，快速创建。并且如果有特殊的需求，也会显示表所存在的分层，ods 层， dw 层还是 dm 层， 亦或者直接将生成的 DDL 语句展示出来，提供复制。
8. tdw 是账号级别的管理。
9. 字段的维度字典沉淀，统一设定。
10. 数仓现在不管权限问题，所有的开发者都有数据的全部权限，管权限的只有产品经理，在另一个平台建立了一份角色和权限点的关系，在数据门户侧，实际用户访问到的才是经过权限筛选的数据，这意味着会工程的所有开发，都可以无视权限配置，容易造成数据泄露。那如果权限管控直接沉淀在数据资产平台，权限管控下沉，自己管理数据的隐私问题。

## 数据资产平台

功能：

1. 规范建表，同步字段。提供更灵活的建表体验。统一建表， tdw 表和罗盘库表（结果库？）
2. 沉淀字段（维度、指标）到平台。对维度字典做了更好的统一管控。统一管理和录入字段和维度信息，在建表的时候能够直接拖拽处理。
3. 对数据源、表、字段都做到更细的权限管控。
4. 记录表结构修改记录，标记多表之间的一些血缘关系，以及表与洛子任务的关系。维护一份，关联分析，表之间的联系，血缘关系等。

未来：

1. 数据行权限，感觉可以直接在数据资产平台就做一个绑定。脱离磐石。 数据权限，管控需要更细，像 node 和 tdw 这一层，对真实的数据比较难隐藏，收入数据等是可以直接看到的。
