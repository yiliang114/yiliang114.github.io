<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker部署NodeJs应用 | 易良同学的博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favicon.ico" type="image/jpg">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="docker 是一个开源的应用容器引擎，可以为我们提供安全、可移植、可重复的自动化部署的方式。docker 采用虚拟化的技术来虚拟化出应用程序的运行环境。如上图一样。docker 就像一艘轮船。而轮船上面的每个小箱子可以看成我们需要部署的一个个应用。使用 docker 可以充分利用服务器的系统资源，简化了自动化部署和运维的繁琐流程,减少很多因为开发环境中和生产环境中的不同引发的异常问题。从而提高生产力。
  docker 三个核心概念如下：">
    <meta name="image" content="http://img.shepherd618.cn/docker.jpg">
    <meta name="twitter:title" content="docker部署NodeJs应用">
    <meta name="twitter:description" content="docker 是一个开源的应用容器引擎，可以为我们提供安全、可移植、可重复的自动化部署的方式。docker 采用虚拟化的技术来虚拟化出应用程序的运行环境。如上图一样。docker 就像一艘轮船。而轮船上面的每个小箱子可以看成我们需要部署的一个个应用。使用 docker 可以充分利用服务器的系统资源，简化了自动化部署和运维的繁琐流程,减少很多因为开发环境中和生产环境中的不同引发的异常问题。从而提高生产力。
  docker 三个核心概念如下：">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://img.shepherd618.cn/docker.jpg">
    <meta name="twitter:url" content="https://yiliang.site/_posts/%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/docker/docker%E9%83%A8%E7%BD%B2NodeJs%E5%BA%94%E7%94%A8.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="docker部署NodeJs应用">
    <meta property="og:description" content="docker 是一个开源的应用容器引擎，可以为我们提供安全、可移植、可重复的自动化部署的方式。docker 采用虚拟化的技术来虚拟化出应用程序的运行环境。如上图一样。docker 就像一艘轮船。而轮船上面的每个小箱子可以看成我们需要部署的一个个应用。使用 docker 可以充分利用服务器的系统资源，简化了自动化部署和运维的繁琐流程,减少很多因为开发环境中和生产环境中的不同引发的异常问题。从而提高生产力。
  docker 三个核心概念如下：">
    <meta property="og:image" content="http://img.shepherd618.cn/docker.jpg">
    <meta property="og:url" content="https://yiliang.site/_posts/%E5%90%8E%E5%8F%B0%E5%BC%80%E5%8F%91/%E5%B7%A5%E5%85%B7/docker/docker%E9%83%A8%E7%BD%B2NodeJs%E5%BA%94%E7%94%A8.html">
    <meta property="og:site_name" content="易良 yiliang">
    <meta property="article:published_time" content="2019-09-16">
    <meta property="article:tag" content="docker">
    <meta itemprop="name" content="docker部署NodeJs应用">
    <meta itemprop="description" content="docker 是一个开源的应用容器引擎，可以为我们提供安全、可移植、可重复的自动化部署的方式。docker 采用虚拟化的技术来虚拟化出应用程序的运行环境。如上图一样。docker 就像一艘轮船。而轮船上面的每个小箱子可以看成我们需要部署的一个个应用。使用 docker 可以充分利用服务器的系统资源，简化了自动化部署和运维的繁琐流程,减少很多因为开发环境中和生产环境中的不同引发的异常问题。从而提高生产力。
  docker 三个核心概念如下：">
    <meta itemprop="image" content="http://img.shepherd618.cn/docker.jpg">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    
    <link rel="preload" href="/assets/js/vendor.vue.22470dd9.js" as="script"><link rel="preload" href="/assets/css/0.styles.63940afe.css" as="style"><link rel="preload" href="/assets/js/vendor.commons.63940afe.js" as="script"><link rel="preload" href="/assets/js/app.34947d8e.js" as="script"><link rel="preload" href="/assets/js/15.55718840.js" as="script"><link rel="prefetch" href="/assets/js/10.9a756169.js"><link rel="prefetch" href="/assets/js/11.85f8dab7.js"><link rel="prefetch" href="/assets/js/12.b4cc6c17.js"><link rel="prefetch" href="/assets/js/13.fbfbe27e.js"><link rel="prefetch" href="/assets/js/14.dd96edfa.js"><link rel="prefetch" href="/assets/js/16.73f8e254.js"><link rel="prefetch" href="/assets/js/17.9f60deb8.js"><link rel="prefetch" href="/assets/js/18.ac011fe0.js"><link rel="prefetch" href="/assets/js/19.495fea85.js"><link rel="prefetch" href="/assets/js/20.b94e8387.js"><link rel="prefetch" href="/assets/js/21.a899318f.js"><link rel="prefetch" href="/assets/js/22.8e8c9ab8.js"><link rel="prefetch" href="/assets/js/23.635fbb1c.js"><link rel="prefetch" href="/assets/js/24.2c7afe79.js"><link rel="prefetch" href="/assets/js/25.4a17c9ae.js"><link rel="prefetch" href="/assets/js/26.d1b3b48a.js"><link rel="prefetch" href="/assets/js/27.9d447c0a.js"><link rel="prefetch" href="/assets/js/28.ab638595.js"><link rel="prefetch" href="/assets/js/29.049a9710.js"><link rel="prefetch" href="/assets/js/3.5778f50e.js"><link rel="prefetch" href="/assets/js/30.7dcc7a8c.js"><link rel="prefetch" href="/assets/js/31.ab880fe4.js"><link rel="prefetch" href="/assets/js/32.0e0cbd28.js"><link rel="prefetch" href="/assets/js/33.d0f8a4fc.js"><link rel="prefetch" href="/assets/js/34.0d1eca53.js"><link rel="prefetch" href="/assets/js/35.8f67d7e8.js"><link rel="prefetch" href="/assets/js/36.7f1e0fe5.js"><link rel="prefetch" href="/assets/js/37.8207e352.js"><link rel="prefetch" href="/assets/js/38.fcb47a79.js"><link rel="prefetch" href="/assets/js/39.e26e8758.js"><link rel="prefetch" href="/assets/js/4.6697030e.js"><link rel="prefetch" href="/assets/js/40.511b7362.js"><link rel="prefetch" href="/assets/js/41.23980a04.js"><link rel="prefetch" href="/assets/js/42.7d812c8f.js"><link rel="prefetch" href="/assets/js/43.e9f4c163.js"><link rel="prefetch" href="/assets/js/44.a70b510d.js"><link rel="prefetch" href="/assets/js/45.0e3f6992.js"><link rel="prefetch" href="/assets/js/46.42614d9e.js"><link rel="prefetch" href="/assets/js/47.acc03387.js"><link rel="prefetch" href="/assets/js/48.1f987f52.js"><link rel="prefetch" href="/assets/js/49.53a7fd46.js"><link rel="prefetch" href="/assets/js/5.c3113993.js"><link rel="prefetch" href="/assets/js/50.eb913ef1.js"><link rel="prefetch" href="/assets/js/51.24dbae80.js"><link rel="prefetch" href="/assets/js/52.5fcfa379.js"><link rel="prefetch" href="/assets/js/53.fd9f3e2b.js"><link rel="prefetch" href="/assets/js/54.56ca5860.js"><link rel="prefetch" href="/assets/js/55.5997fac6.js"><link rel="prefetch" href="/assets/js/56.9c74e6d6.js"><link rel="prefetch" href="/assets/js/57.f24bf036.js"><link rel="prefetch" href="/assets/js/58.5c310d29.js"><link rel="prefetch" href="/assets/js/6.72d4d30e.js"><link rel="prefetch" href="/assets/js/7.64e679fc.js"><link rel="prefetch" href="/assets/js/8.f5c49058.js"><link rel="prefetch" href="/assets/js/9.b9fcef5c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.63940afe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-yiliang114"><header class="header" data-v-684ee972><div data-v-0b0af033 data-v-684ee972><nav class="navbar" data-v-0b0af033><div class="container" data-v-0b0af033><a href="/" class="router-link-active" data-v-0b0af033><span class="navbar-site-name" data-v-0b0af033>易良同学的博客</span></a> <div class="navbar-toggler" data-v-0b0af033><svg class="icon" style="font-size:1.2em;" data-v-0b0af033 data-v-0b0af033><title data-v-0b0af033 data-v-0b0af033>menu</title><use xlink:href="#icon-menu" data-v-0b0af033 data-v-0b0af033></use></svg></div> <div class="navbar-links" data-v-0b0af033><a href="/" class="navbar-link" data-v-0b0af033>首页</a><a href="/posts/" class="navbar-link router-link-active" data-v-0b0af033>文章</a><a href="/posts/categories/" class="navbar-link" data-v-0b0af033>分类</a><a href="/links/" class="navbar-link" data-v-0b0af033>友链</a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-0b0af033></div></div> <div class="banner" data-v-4f70089d data-v-684ee972 data-v-684ee972><div class="container" data-v-4f70089d><div class="center" data-v-4f70089d><h1 data-v-4f70089d data-v-684ee972>docker部署NodeJs应用</h1></div></div></div></header> <div class="container clearfix show-aside" data-v-5e7fbdae data-v-5e7fbdae><main class="main" data-v-5e7fbdae><div class="post" data-v-5e7fbdae><section class="post-meta main-div" data-v-42efe1fc><section class="post-date clearfix" data-v-42efe1fc><span class="create-date" data-v-42efe1fc>发布时间 : 2019-09-16</span> <!----></section> <section class="post-links" data-v-42efe1fc><a href="/posts/2019/09/16/ubuntu-%E5%AE%89%E8%A3%85-docker.html" class="post-link" data-v-42efe1fc>上一篇 : ubuntu 安装 docker</a> <a href="/posts/2019/09/16/docker%E4%BB%8B%E7%BB%8D.html" class="post-link" data-v-42efe1fc>下一篇 : Docker 介绍</a></section></section> <article class="main-div"><div class="post-content content content__default"><h1 id="docker-简介"><a href="#docker-简介" class="header-anchor">#</a> docker 简介</h1> <p><img src="http://img.shepherd618.cn/docker.jpg" alt="enter image description here">
  docker 是一个开源的应用容器引擎，可以为我们提供安全、可移植、可重复的自动化部署的方式。docker 采用虚拟化的技术来虚拟化出应用程序的运行环境。如上图一样。docker 就像一艘轮船。而轮船上面的每个小箱子可以看成我们需要部署的一个个应用。使用 docker 可以充分利用服务器的系统资源，简化了自动化部署和运维的繁琐流程,减少很多因为开发环境中和生产环境中的不同引发的异常问题。从而提高生产力。
  docker 三个核心概念如下：</p> <ul><li><p>镜像（images）：一个只读的模板，可以理解为应用程序的运行环境，包含了程序运行所依赖的环境和基本配置。相当于上图中的每个小箱子里面装的东西。</p></li> <li><p>仓库（repository）：一个用于存放镜像文件的仓库。可以看做和 gitlab 一样。</p></li> <li><p>容器（container）：一个运行应用程序的虚拟容器，他和镜像最大的区别在于容器的最上面那一层是可读可写的。 相当于上图中的每个小箱子里。</p></li></ul> <h1 id="docker-安装"><a href="#docker-安装" class="header-anchor">#</a> docker 安装</h1> <h2 id="mac"><a href="#mac" class="header-anchor">#</a> mac</h2> <p><a href="https://www.docker.com/docker-mac" target="_blank" rel="noopener noreferrer">官网下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，点击下载即可。</p> <h2 id="liunx"><a href="#liunx" class="header-anchor">#</a> liunx</h2> <p>打开终端 输入</p> <div class="language- extra-class"><pre class="language-text"><code>curl https://releases.rancher.com/install-docker/17.12.sh | sh
</code></pre></div><p>等待安装完成。检查是否安装成功。
环境已经安装完毕。现在来开始部署应用吧。</p> <h1 id="docker-实战"><a href="#docker-实战" class="header-anchor">#</a> docker 实战</h1> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <h2 id="初始化一个-nodejs-程序"><a href="#初始化一个-nodejs-程序" class="header-anchor">#</a> 初始化一个 NodeJs 程序</h2> <p>以下操作必须已经安装了 NodeJS。如果没有安装请参照之前的教程<a href="http://shepherd618.cn/2018/01/08/ubuntu%E9%83%A8%E7%BD%B2NodeJs%E7%BA%BF%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
首先创建一个空文件夹。并创建以下文件：</p> <ul><li>server.js</li> <li>package.json</li> <li>Dockerfile</li> <li>.dockerignore</li></ul> <div class="language- extra-class"><pre class="language-text"><code>mkdir docker_demo
cd docker_demo
touch server.js
touch package.json
touch Dockerfile
touch .dockerignore
</code></pre></div><p>然后在 server.js 写入</p> <div class="language- extra-class"><pre class="language-text"><code>const Koa = require('koa');
const app = new Koa();

app.use(async ctx =&gt; {
   ctx.body = 'Hello docker';
});

app.listen(3000);
</code></pre></div><p>在 package.json 中写入</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;name&quot;: &quot;docker_demo&quot;,
 &quot;version&quot;: &quot;0.1.0&quot;,
 &quot;private&quot;: true,
 &quot;scripts&quot;: {
   &quot;start&quot;: &quot;node server.js&quot;
 },
 &quot;dependencies&quot;: {
   &quot;koa&quot;: &quot;^2.5.0&quot;
}
}
</code></pre></div><p>测试程序。控制台输入</p> <div class="language- extra-class"><pre class="language-text"><code>npm start
</code></pre></div><p>浏览器打开<a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">本地测试<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,如果如图所示。表示 demo 创建成功。请继续往下。</p> <h2 id="创建-dockerfile-文件"><a href="#创建-dockerfile-文件" class="header-anchor">#</a> 创建 dockerfile 文件</h2> <p>Dockerfile 是由一系列命令和参数构成的脚本，一个 Dockerfile 里面包含了构建整个 image 的完整命令。Docker 通过 docker build 执行 Dockerfile 中的一系列命令自动构建 image.
在.dockerignore 文件里面写入代码。表示过滤该类型的文件。类似 git 的.gitignore</p> <div class="language- extra-class"><pre class="language-text"><code># Logs
logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules
jspm_packages

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history
.idea
.node_modules
node_modules
.vscode
</code></pre></div><p>在 Dockerfile 文件中写入以下代码：</p> <div class="language- extra-class"><pre class="language-text"><code>#制定node镜像的版本
FROM node:8.9-alpine
#声明作者
MAINTAINER robin
#移动当前目录下面的文件到app目录下
ADD . /app/
#进入到app目录下面，类似cd
WORKDIR /app
#安装依赖
RUN npm install
#对外暴露的端口
EXPOSE 3000
#程序启动脚本
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre></div><h2 id="构建镜像"><a href="#构建镜像" class="header-anchor">#</a> 构建镜像</h2> <p>使用 build 命令构造镜像,注意后面那个.不能少。</p> <div class="language- extra-class"><pre class="language-text"><code>docker build -t docker_demo .
robin:docker_demo robin$ docker build -t docker_demo .
Sending build context to Docker daemon  39.94kB
Step 1/7 : FROM node:8.9-alpine
---&gt; 406f227b21f5
Step 2/7 : MAINTAINER robin
---&gt; Using cache
---&gt; 78d6cdbcfee2
Step 3/7 : ADD . /app/
---&gt; 2cb30678612d
Step 4/7 : WORKDIR /app
Removing intermediate container e51377081039
---&gt; c2b7d0f37d2d
Step 5/7 : RUN npm install
---&gt; Running in da0c3946ca8d
npm notice created a lockfile as package-lock.json. You should commit this file.
added 38 packages in 3.323s
Removing intermediate container da0c3946ca8d
---&gt; eecee87f10e2
Step 6/7 : EXPOSE 3000
---&gt; Running in f3973cc168a4
Removing intermediate container f3973cc168a4
---&gt; 2671a4c6deb4
Step 7/7 : CMD [&quot;npm&quot;, &quot;start&quot;]
---&gt; Running in dec529f754aa
Removing intermediate container dec529f754aa
---&gt; 6ec73793d353
Successfully built 6ec73793d353
Successfully tagged docker_demo:latest
</code></pre></div><p>等待镜像构造完成。然后使用 images 命令查看镜像。</p> <p>此时可以看到 images 已经构造完成。现在开始启动 images，并测试。</p> <div class="language- extra-class"><pre class="language-text"><code>#启动镜像 -d表示后台执行，-p 9000:3000表示指定本地的9000端口隐射到容器内的3000端口，docker_demo为镜像名称
docker run -d -p 9000:3000 docker_demo
#查看容器
docker ps
</code></pre></div><p>此时浏览器打开 http://localhost:9000/,如果如图所示。表示容器运行正常。</p> <p>如果此时本地无法打开。可以使用 log 命令查看日志。根据日志修改对应出现的对方。</p> <h2 id="绑定-docke-hub"><a href="#绑定-docke-hub" class="header-anchor">#</a> 绑定 docke hub</h2> <p>镜像已经存在了我们本机硬盘，那我们实际中要么上传到服务器呢？这里通常有 2 个方法。一直是自己搭建镜像仓库比如（harbor）,还有就是官方的 docke hub，类似 gitlab。我们这里先以 docke hub 为列。harbor 放在下篇博客。首先需要注册 docke hub 账号,<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">官网注册地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。然后登陆。</p> <div class="language- extra-class"><pre class="language-text"><code>robin:docker_demo robin$ docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username:xxxxxx
Password:
Login Succeeded
robin:docker_demo robin$
</code></pre></div><p>登陆成功之后。需要给当前 images。添加 tag,并 push</p> <div class="language- extra-class"><pre class="language-text"><code>#格式docker tag 标签名 用户名/标签名
docker tag docker_demo robin365/docker_demo
#格式docker push 用户名/标签名
docker push robin365/docker_demo
</code></pre></div><p>完成之后,可以登陆<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">docke hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查看刚刚 push 的镜像。我们可以设置这个镜像是否公开。Public：所有人都可以下载。Private：表示自己才能下载。</p> <p>这样我们已经把 images 上传到 docke hub 了,在我们需要用到这个 images 的时候可以直接通过 docker pull 命令下载使用了。</p> <p>到此本教程结束。实际项目中部署可能会出现各种各样的问题，我们需要多查看 log。根据 log 去做相应修改。后面我也会整理出有关 docke 在部署 nodejs 应用中的一些比较容易出错的地方。</p> <h1 id="dockerc-常用命令"><a href="#dockerc-常用命令" class="header-anchor">#</a> dockerc 常用命令</h1> <div class="language- extra-class"><pre class="language-text"><code>#查看当前docker版本
docker -v
#查看当前本地所有镜像
docker images
#构造镜像,用法docker build -t 镜像名称 .
docker build -t docker_demo .
#用于容器与主机之间的数据拷贝。用法docker cp 主机文件地址 容器内地址。12d7f14v45cv为容器id。
docker cp /www/runoob 12d7f14v45cv:/www/
#创建一个新的容器并运行，-d为后台执行，-p 9000:3000前面为主机端口，后面是容器端口。docker_demo镜像名
docker run -d -p 9000:3000 docker_demo
#启动已被停止的容器
docker start docker_demo
#关闭已被启动的容器
docker stop docker_demo
#重新启动容器
docker restart docker_demo
#杀掉一个运行中的容器。
docker kill -s KILL docker_demo
#删除一个或多少容器。-f :通过SIGKILL信号强制删除一个运行中的容器-l :移除容器间的网络连接，而非容器本身-v :-v 删除与容器关联的卷
docker rm -f docker_demo、docker_demo1
#在运行的容器中执行命令。104e28f2f072容器id
sudo docker exec -it 104e28f2f072 /bin/bash
#列出容器。 -a:所有容器包含没有运行的
docker ps
#获取容器获取容器的日志 104e28f2f072容器id，-t:显示时间戳
docker logs -f -t 104e28f2f072
#登陆镜像仓库
docker login
#获取镜像
docker pull
#上传镜像
docker push
#查看指定镜像的创建历史。
docker history docker_demo
</code></pre></div><h1 id="基于-docker-部署-nodejs-应用"><a href="#基于-docker-部署-nodejs-应用" class="header-anchor">#</a> 基于 Docker 部署 nodejs 应用</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>公司基于 Vue.js 的项目最近需要部署到云端，因此需要先行在公司内部 Docker 环境下验证相关技术，因而有本文之前提。
本文展示在 Docker 容器中，应用部署 Nodejs 程序。</p> <h2 id="获取基础镜像"><a href="#获取基础镜像" class="header-anchor">#</a> 获取基础镜像</h2> <p>Docker Hub 中有<a href="https://hub.docker.com/_/node/" target="_blank" rel="noopener noreferrer">官方 node 镜像<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，按照自己的需求直接获取对应版本的 image 即可。我获取的是<code>8.0-alpine</code>版本，因为基于 alpine 的 node 镜像足够小，仅有 63.7 MB。</p> <h2 id="获取源码"><a href="#获取源码" class="header-anchor">#</a> 获取源码</h2> <p>从源码库上，获取到整个源代码工程。（过程略）</p> <h2 id="编写-dockerfile"><a href="#编写-dockerfile" class="header-anchor">#</a> 编写 Dockerfile</h2> <p>首先，我们确立文档模型。目录结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>~/nodejs
    Order/        [nodejs源码目录]
    Dockerfile
</code></pre></div><p>Dockerfile 内容如下</p> <div class="language- extra-class"><pre class="language-text"><code># 引用镜像
FROM node:8.0-alpine

# 作者
MAINTAINER yubing

# 执行命令，创建文件夹
RUN mkdir -p /home/Order

# 将Order目录拷贝到镜像里
ADD ./Order /home/Order

# 指定工作目录
WORKDIR /home/Order

# 安装依赖及构建node应用
RUN npm install
RUN npm build

# 配置系统变量，指定端口
ENV HOST 0.0.0.0
ENV PORT 8081

# 将端口8081开放
EXPOSE 8081

# 容器启动命令
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre></div><h2 id="构建镜像-2"><a href="#构建镜像-2" class="header-anchor">#</a> 构建镜像</h2> <p>在 Dockerfile 所在目录执行 docker build 命令，构建镜像。
<code>docker build --rm -t orderui:20180531 .</code>
其中，--rm 是删除构建过程中，产生的临时镜像，-t 是指定镜像名称及标识，如：orderui:20180531，最后. 代表默认选择 Dockerfile 为构建文件。</p> <h2 id="创建容器"><a href="#创建容器" class="header-anchor">#</a> 创建容器</h2> <p><code>docker run -p 8081:8081 --name orderui -d orderui:20180531</code>
-p 是指定端口映射，--name 给容器命名，-d 后台执行</p> <p>稍等片刻，等 npm start 执行完毕后，即可访问。</p> <h1 id="demo"><a href="#demo" class="header-anchor">#</a> demo</h1> <h2 id="部署-node"><a href="#部署-node" class="header-anchor">#</a> 部署 node</h2> <p>https://www.cnblogs.com/pass245939319/p/8473861.html</p></div></article> <section class="post-meta main-div" data-v-42efe1fc><section class="post-date clearfix" data-v-42efe1fc><span class="create-date" data-v-42efe1fc>发布时间 : 2019-09-16</span> <!----></section> <section class="post-links" data-v-42efe1fc><a href="/posts/2019/09/16/ubuntu-%E5%AE%89%E8%A3%85-docker.html" class="post-link" data-v-42efe1fc>上一篇 : ubuntu 安装 docker</a> <a href="/posts/2019/09/16/docker%E4%BB%8B%E7%BB%8D.html" class="post-link" data-v-42efe1fc>下一篇 : Docker 介绍</a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-5e7fbdae><!----> <!----> <div class="post-nav-card main-div" data-v-5e7fbdae><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#mac">mac</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#liunx">liunx</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#准备工作">准备工作</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#初始化一个-nodejs-程序">初始化一个 NodeJs 程序</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#创建-dockerfile-文件">创建 dockerfile 文件</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#构建镜像">构建镜像</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#绑定-docke-hub">绑定 docke hub</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#背景">背景</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#获取基础镜像">获取基础镜像</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#获取源码">获取源码</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#编写-dockerfile">编写 Dockerfile</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#构建镜像-2">构建镜像</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#创建容器">创建容器</a></li><li><a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#部署-node">部署 node</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2019/09/16/docker%E9%83%A8%E7%BD%B2nodejs%E5%BA%94%E7%94%A8.html#post-comments">评论</a></div></div></aside></div> <footer class="footer" data-v-fcc2f45a><p class="footer-sns-links" data-v-fcc2f45a><a href="https://github.com/yiliang114" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="GitHub: yiliang" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>GitHub: yiliang</title><use xlink:href="#icon-github" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a><a href="https://twitter.com/yiliang79503471" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="Twitter: yiliang" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>Twitter: yiliang</title><use xlink:href="#icon-twitter" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a><a href="https://weibo.com/u/3386520174" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="新浪微博: @易良同学" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>新浪微博: @易良同学</title><use xlink:href="#icon-weibo" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a><a href="https://www.zhihu.com/people/Mrz2J" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="知乎: 易良" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>知乎: 易良</title><use xlink:href="#icon-zhihu" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a><a href="https://blog.csdn.net/GreekMrzzJ" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="CSDN: yiliang" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>CSDN: yiliang</title><use xlink:href="#icon-csdn" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a><a href="https://juejin.im/user/58809a6db123db0061cfd1c3" target="_blank" rel="noopener" class="sns-link" data-v-fcc2f45a><span title="掘金: yiliang" class="sns-icon" data-v-fcc2f45a data-v-fcc2f45a><svg class="icon" style="font-size:25px;" data-v-fcc2f45a data-v-fcc2f45a><title data-v-fcc2f45a data-v-fcc2f45a>掘金: yiliang</title><use xlink:href="#icon-juejin" data-v-fcc2f45a data-v-fcc2f45a></use></svg></span></a></p> <!----> <p class="footer-text" data-v-fcc2f45a><span data-v-fcc2f45a>浙ICP备16046652号</span></p> <p class="footer-text" data-v-fcc2f45a>Copyright 2018-present <a href="https://github.com/yiliang114" target="_blank">yiliang114</a> | MIT License</p></footer></div><div class="global-ui"><!----><!----><div></div><canvas id="vuepress-canvas-cursor"></canvas><!----></div></div>
    <script src="/assets/js/vendor.vue.22470dd9.js" defer></script><script src="/assets/js/15.55718840.js" defer></script><script src="/assets/js/vendor.commons.63940afe.js" defer></script><script src="/assets/js/app.34947d8e.js" defer></script>
  </body>
</html>
